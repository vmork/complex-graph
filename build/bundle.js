var app=function(){"use strict";function e(){}const t=e=>e;function n(e){return e()}function r(){return Object.create(null)}function s(e){e.forEach(n)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function c(e){let t;return a(e,(e=>t=e))(),t}function l(e,t,n){e.$$.on_destroy.push(a(t,n))}function u(e,t,n){return e.set(n),t}const h="undefined"!=typeof window;let d=h?()=>window.performance.now():()=>Date.now(),m=h?e=>requestAnimationFrame(e):e;const f=new Set;function p(e){f.forEach((t=>{t.c(e)||(f.delete(t),t.f())})),0!==f.size&&m(p)}function g(e){let t;return 0===f.size&&m(p),{promise:new Promise((n=>{f.add(t={c:e,f:n})})),abort(){f.delete(t)}}}function v(e,t){e.appendChild(t)}function y(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function b(e){const t=S("style");return function(e,t){v(e.head||e,t),t.sheet}(y(e),t),t.sheet}function E(e,t,n){e.insertBefore(t,n||null)}function x(e){e.parentNode&&e.parentNode.removeChild(e)}function $(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function S(e){return document.createElement(e)}function R(e){return document.createTextNode(e)}function L(){return R(" ")}function w(){return R("")}function A(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function k(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function T(e){return""===e?null:+e}function _(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function U(e,t){e.value=null==t?"":t}function N(e,t,n,r){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function I(e,t,n){e.classList[n?"add":"remove"](t)}function O(e,t,{bubbles:n=!1,cancelable:r=!1}={}){const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,n,r,t),s}const F=new Map;let C,B=0;function D(e,t,n,r,s,i,o,a=0){const c=16.666/r;let l="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*i(e);l+=100*e+`%{${o(r,1-r)}}\n`}const u=l+`100% {${o(n,1-n)}}\n}`,h=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${a}`,d=y(e),{stylesheet:m,rules:f}=F.get(d)||function(e,t){const n={stylesheet:b(t),rules:{}};return F.set(e,n),n}(d,e);f[h]||(f[h]=!0,m.insertRule(`@keyframes ${h} ${u}`,m.cssRules.length));const p=e.style.animation||"";return e.style.animation=`${p?`${p}, `:""}${h} ${r}ms linear ${s}ms 1 both`,B+=1,h}function M(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),s=n.length-r.length;s&&(e.style.animation=r.join(", "),B-=s,B||m((()=>{B||(F.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&x(t)})),F.clear())})))}function z(e){C=e}function P(){if(!C)throw new Error("Function called outside component initialization");return C}function j(){const e=P();return(t,n,{cancelable:r=!1}={})=>{const s=e.$$.callbacks[t];if(s){const i=O(t,n,{cancelable:r});return s.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}function G(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e.call(this,t)))}const W=[],V=[],Q=[],H=[],X=Promise.resolve();let q=!1;function Y(e){Q.push(e)}function K(e){H.push(e)}const J=new Set;let Z,ee=0;function te(){if(0!==ee)return;const e=C;do{try{for(;ee<W.length;){const e=W[ee];ee++,z(e),ne(e.$$)}}catch(e){throw W.length=0,ee=0,e}for(z(null),W.length=0,ee=0;V.length;)V.pop()();for(let e=0;e<Q.length;e+=1){const t=Q[e];J.has(t)||(J.add(t),t())}Q.length=0}while(W.length);for(;H.length;)H.pop()();q=!1,J.clear(),z(e)}function ne(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Y)}}function re(){return Z||(Z=Promise.resolve(),Z.then((()=>{Z=null}))),Z}function se(e,t,n){e.dispatchEvent(O(`${t?"intro":"outro"}${n}`))}const ie=new Set;let oe;function ae(){oe={r:0,c:[],p:oe}}function ce(){oe.r||s(oe.c),oe=oe.p}function le(e,t){e&&e.i&&(ie.delete(e),e.i(t))}function ue(e,t,n,r){if(e&&e.o){if(ie.has(e))return;ie.add(e),oe.c.push((()=>{ie.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const he={duration:0};function de(n,r,o,a){const c={direction:"both"};let l=r(n,o,c),u=a?0:1,h=null,m=null,f=null;function p(){f&&M(n,f)}function v(e,t){const n=e.b-u;return t*=Math.abs(n),{a:u,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function y(r){const{delay:i=0,duration:o=300,easing:a=t,tick:c=e,css:y}=l||he,b={start:d()+i,b:r};r||(b.group=oe,oe.r+=1),h||m?m=b:(y&&(p(),f=D(n,u,r,o,i,a,y)),r&&c(0,1),h=v(b,o),Y((()=>se(n,r,"start"))),g((e=>{if(m&&e>m.start&&(h=v(m,o),m=null,se(n,h.b,"start"),y&&(p(),f=D(n,u,h.b,h.duration,0,a,l.css))),h)if(e>=h.end)c(u=h.b,1-u),se(n,h.b,"end"),m||(h.b?p():--h.group.r||s(h.group.c)),h=null;else if(e>=h.start){const t=e-h.start;u=h.a+h.d*a(t/h.duration),c(u,1-u)}return!(!h&&!m)})))}return{run(e){i(l)?re().then((()=>{l=l(c),y(e)})):y(e)},end(){p(),h=m=null}}}function me(e,t){ue(e,1,1,(()=>{t.delete(e.key)}))}function fe(e,t,n,r,s,i,o,a,c,l,u,h){let d=e.length,m=i.length,f=d;const p={};for(;f--;)p[e[f].key]=f;const g=[],v=new Map,y=new Map;for(f=m;f--;){const e=h(s,i,f),a=n(e);let c=o.get(a);c?r&&c.p(e,t):(c=l(a,e),c.c()),v.set(a,g[f]=c),a in p&&y.set(a,Math.abs(f-p[a]))}const b=new Set,E=new Set;function x(e){le(e,1),e.m(a,u),o.set(e.key,e),u=e.first,m--}for(;d&&m;){const t=g[m-1],n=e[d-1],r=t.key,s=n.key;t===n?(u=t.first,d--,m--):v.has(s)?!o.has(r)||b.has(r)?x(t):E.has(s)?d--:y.get(r)>y.get(s)?(E.add(r),x(t)):(b.add(s),d--):(c(n,o),d--)}for(;d--;){const t=e[d];v.has(t.key)||c(t,o)}for(;m;)x(g[m-1]);return g}function pe(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function ge(e){e&&e.c()}function ve(e,t,r,o){const{fragment:a,after_update:c}=e.$$;a&&a.m(t,r),o||Y((()=>{const t=e.$$.on_mount.map(n).filter(i);e.$$.on_destroy?e.$$.on_destroy.push(...t):s(t),e.$$.on_mount=[]})),c.forEach(Y)}function ye(e,t){const n=e.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function be(e,t){-1===e.$$.dirty[0]&&(W.push(e),q||(q=!0,X.then(te)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ee(t,n,i,o,a,c,l,u=[-1]){const h=C;z(t);const d=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(h?h.$$.context:[])),callbacks:r(),dirty:u,skip_bound:!1,root:n.target||h.$$.root};l&&l(d.root);let m=!1;if(d.ctx=i?i(t,n.props||{},((e,n,...r)=>{const s=r.length?r[0]:n;return d.ctx&&a(d.ctx[e],d.ctx[e]=s)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](s),m&&be(t,e)),n})):[],d.update(),m=!0,s(d.before_update),d.fragment=!!o&&o(d.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);d.fragment&&d.fragment.l(e),e.forEach(x)}else d.fragment&&d.fragment.c();n.intro&&le(t.$$.fragment),ve(t,n.target,n.anchor,n.customElement),te()}z(h)}class xe{$destroy(){ye(this,1),this.$destroy=e}$on(t,n){if(!i(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function $e(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}const Se={setEventListeners:!0},Re=new Event("camera");class Le{constructor(e,t=Se){this.options=Se,this.canvas=e,this.options=t,this.reset(),t.setEventListeners&&(this.canvas.addEventListener("wheel",(e=>{e.preventDefault(),this.scaleAt(e.offsetX,e.offsetY,Math.pow(1.001,e.deltaY))})),this.canvas.addEventListener("mousemove",(e=>{1==e.buttons&&this.move(e.movementX,e.movementY)})))}w(){return this.canvas.width}h(){return this.canvas.height}aspect(){return this.w()/this.h()}reset(){this.origin={x:0,y:0},this.scale={x:this.aspect(),y:1},this.canvas.dispatchEvent(Re)}screenToWorld(e,t){return{x:this.origin.x+this.scale.x*(2*e/this.canvas.width-1),y:this.origin.y+this.scale.y*(-2*t/this.canvas.height+1)}}worldToScreen(e,t){return{x:this.canvas.width/2*(1+(e-this.origin.x)/this.scale.x),y:this.canvas.height/2*(1-(t-this.origin.y)/this.scale.y)}}scaleAt(e,t,n){const r=this.screenToWorld(e,t),s=1-n;this.origin.x+=s*(r.x-this.origin.x),this.origin.y+=s*(r.y-this.origin.y),this.scale.x*=n,this.scale.y*=n,this.canvas.dispatchEvent(Re)}move(e,t){this.origin.x-=e/this.w()*this.scale.x*2,this.origin.y+=t/this.h()*this.scale.y*2,this.canvas.dispatchEvent(Re)}getWorldMatrix(){return[this.scale.x,0,0,0,this.scale.y,0,this.origin.x,this.origin.y,1]}}class we extends Error{constructor(e,t,n){super(e),this.name="ShaderError",this.shaderType=t,this.fileName=n}toString(){return`GLSL ERROR: ${this.message}`}}function Ae(e){const t=e.clientWidth,n=e.clientHeight,r=e.width!==t||e.height!==n;return r&&(e.width=t,e.height=n),r}function ke(e){return $e(this,void 0,void 0,(function*(){let t=yield fetch(e);return yield t.text()}))}class Te{constructor(e,t,n=null,r=null){this.name=e,this.type=t,this.value=n,this.loc=r}}function _e(e,t,n){let r=new RegExp(`//#${t}`);return e.replace(r,`//#${t}\n${n}`)}class Ue{constructor(e,t){this.gl=e,this.id=e.createProgram(),this.uniforms=new Map,this.addUniforms(t)}compileShader(e,t,n){const r=this.gl;let s=r.createShader(e);if(r.shaderSource(s,t),r.compileShader(s),!r.getShaderParameter(s,r.COMPILE_STATUS)){let t=r.getShaderInfoLog(s);throw r.deleteShader(s),this.isCompiled=!1,new we(t,e,n)}return s}compileFromUrls(e,t,n){return $e(this,void 0,void 0,(function*(){this.vertUrl=e,this.fragUrl=t;let r=yield ke(e),s=yield ke(t);return s=yield function(e){return $e(this,void 0,void 0,(function*(){let t=e.split("\n"),n="";for(let e of t)if(n+=e+"\n",e.trim().startsWith("//#include")){let t=e.split(" ")[1];n+=(yield ke(`shaders/${t}`))+"\n"}return n}))}(s),this.vertSrcRaw=r,this.fragSrcRaw=s,this.compile(r,s,n)}))}compile(e,t,n){const r=this.gl;t=function(e,t){return _e(e,"UFUNC",t)}(t,n),t=function(e,t){let n="";for(let e of t)n+=`uniform ${e.type} ${e.name};\n`;return _e(e,"UNIFORMS",n)}(t,this.uniforms.values()),this.isCompiled=!0;const s=this.compileShader(r.VERTEX_SHADER,e,this.vertUrl),i=this.compileShader(r.FRAGMENT_SHADER,t,this.fragUrl);return r.attachShader(this.id,s),r.attachShader(this.id,i),r.linkProgram(this.id),r.getProgramParameter(this.id,r.LINK_STATUS)?(this.setUniformLocations(),this.vertShader=s,this.fragShader=i,this.id):(console.error("Error in creating program: ",r.getProgramInfoLog(this.id)),void r.deleteProgram(this.id))}recompile(e){const t=this.gl;this.isCompiled&&(t.detachShader(this.id,this.vertShader),t.deleteShader(this.vertShader),t.detachShader(this.id,this.fragShader),t.deleteShader(this.fragShader)),this.compile(this.vertSrcRaw,this.fragSrcRaw,e)}addUniforms(e){for(let t of e)this.addUniform(t)}addUniform(e){this.uniforms.has(e.name)?console.error(`Uniform ${e.name} already exists in program`):this.uniforms.set(e.name,e)}deleteUniform(e){this.uniforms.delete(e)}setUniformValue(e,t){this.uniforms.get(e).value=t}getUniformValue(e){return this.uniforms.get(e).value}logUniforms(){console.table(Array.from(this.uniforms.values()).map((e=>[e.name,e.value])))}setUniformLocations(){for(let e of this.uniforms.values())e.loc=this.gl.getUniformLocation(this.id,e.name)}bindAllUniforms(){const e=this.gl;for(let t of this.uniforms.values())"float"===t.type?e.uniform1f(t.loc,t.value):"vec2"===t.type?e.uniform2fv(t.loc,t.value):"int"===t.type?e.uniform1i(t.loc,t.value):"mat2"===t.type?e.uniformMatrix2fv(t.loc,!1,t.value):"mat3"===t.type?e.uniformMatrix3fv(t.loc,!1,t.value):"bool"===t.type?e.uniform1i(t.loc,t.value):console.error("Unsupported uniform type: "+t.type)}}let Ne;const Ie=new Uint8Array(16);function Oe(){if(!Ne&&(Ne="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ne))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ne(Ie)}const Fe=[];for(let e=0;e<256;++e)Fe.push((e+256).toString(16).slice(1));var Ce={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Be(e,t,n){if(Ce.randomUUID&&!t&&!e)return Ce.randomUUID();const r=(e=e||{}).random||(e.rng||Oe)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Fe[e[t+0]]+Fe[e[t+1]]+Fe[e[t+2]]+Fe[e[t+3]]+"-"+Fe[e[t+4]]+Fe[e[t+5]]+"-"+Fe[e[t+6]]+Fe[e[t+7]]+"-"+Fe[e[t+8]]+Fe[e[t+9]]+"-"+Fe[e[t+10]]+Fe[e[t+11]]+Fe[e[t+12]]+Fe[e[t+13]]+Fe[e[t+14]]+Fe[e[t+15]]}(r)}function De(e){e.target.style.position="absolute",e.target.style.width="100%"}function Me(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}function ze(){return`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}`}const Pe=[];function je(t,n=e){let r;const s=new Set;function i(e){if(o(t,e)&&(t=e,r)){const e=!Pe.length;for(const e of s)e[1](),Pe.push(e,t);if(e){for(let e=0;e<Pe.length;e+=2)Pe[e][0](Pe[e+1]);Pe.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(o,a=e){const c=[o,a];return s.add(c),1===s.size&&(r=n(i)||e),o(t),()=>{s.delete(c),0===s.size&&(r(),r=null)}}}}const Ge=je([]),We=je([{id:Be(),type:"float",name:"x",value:0,min:-10,max:10,step:.01},{id:Be(),type:"vec2",name:"p",x:0,y:0,color:ze()}]);var Ve;!function(e){e[e.IDENTIFIER=0]="IDENTIFIER",e[e.LITERAL_REAL=1]="LITERAL_REAL",e[e.LITERAL_IMAG=2]="LITERAL_IMAG",e[e.TRUE=3]="TRUE",e[e.FALSE=4]="FALSE",e[e.LPAREN=5]="LPAREN",e[e.RPAREN=6]="RPAREN",e[e.PLUS=7]="PLUS",e[e.MINUS=8]="MINUS",e[e.STAR=9]="STAR",e[e.SLASH=10]="SLASH",e[e.COMMA=11]="COMMA",e[e.BANG=12]="BANG",e[e.EQUAL=13]="EQUAL",e[e.LESS=14]="LESS",e[e.GREATER=15]="GREATER",e[e.HASH=16]="HASH",e[e.COLON=17]="COLON",e[e.CARET=18]="CARET",e[e.SEMICOLON=19]="SEMICOLON",e[e.BANG_EQUAL=20]="BANG_EQUAL",e[e.EQUAL_EQUAL=21]="EQUAL_EQUAL",e[e.COLON_EQUAL=22]="COLON_EQUAL",e[e.LESS_EQUAL=23]="LESS_EQUAL",e[e.GREATER_EQUAL=24]="GREATER_EQUAL",e[e.DOUBLE_BAR=25]="DOUBLE_BAR",e[e.DOUBLE_AMPERSAND=26]="DOUBLE_AMPERSAND",e[e.ARROW=27]="ARROW",e[e.DOUBLE_DOT=28]="DOUBLE_DOT",e[e.AND=29]="AND",e[e.OR=30]="OR",e[e.IF=31]="IF",e[e.ELSE=32]="ELSE",e[e.ELIF=33]="ELIF",e[e.RETURN=34]="RETURN",e[e.BREAK=35]="BREAK",e[e.FOR=36]="FOR",e[e.WHILE=37]="WHILE",e[e.NEWLINE=38]="NEWLINE",e[e.INDENT=39]="INDENT",e[e.DEDENT=40]="DEDENT",e[e.EOF=41]="EOF"}(Ve||(Ve={}));const Qe=new Map(Object.entries({"(":Ve.LPAREN,")":Ve.RPAREN,"+":Ve.PLUS,"-":Ve.MINUS,"*":Ve.STAR,"/":Ve.SLASH,"^":Ve.CARET,";":Ve.SEMICOLON,",":Ve.COMMA,"!":Ve.BANG,":":Ve.COLON,"=":Ve.EQUAL,"<":Ve.LESS,">":Ve.GREATER,"#":Ve.HASH,"&&":Ve.DOUBLE_AMPERSAND,"||":Ve.DOUBLE_BAR,"==":Ve.EQUAL_EQUAL,"!=":Ve.BANG_EQUAL,"<=":Ve.LESS_EQUAL,">=":Ve.GREATER_EQUAL,":=":Ve.COLON_EQUAL,"..":Ve.DOUBLE_DOT,"->":Ve.ARROW,and:Ve.AND,or:Ve.OR,if:Ve.IF,else:Ve.ELSE,elif:Ve.ELIF,return:Ve.RETURN,break:Ve.BREAK,for:Ve.FOR,while:Ve.WHILE,true:Ve.TRUE,false:Ve.FALSE}));class He{constructor(e,t,n,r=null){this.type=e,this.lexeme=t,this.line=n,this.literal=r}toString(){return{type:Ve[this.type],lexeme:this.lexeme,line:this.line,literal:this.literal}}}class Xe extends Error{constructor(e,t=null,n=null){super(e),this.message=e,this.line=t,this.lexeme=n,Object.setPrototypeOf(this,Xe.prototype)}toString(){return"oije"}}class qe extends Xe{constructor(e,t=null,n=null){super(e),this.message=e,this.line=t,this.lexeme=n,Object.setPrototypeOf(this,qe.prototype)}toString(){return`SYNTAX ERROR: line ${this.line} at '${this.lexeme}': ${this.message}`}}class Ye extends Xe{constructor(e,t=null,n=null){super(e),this.message=e,this.line=t,this.lexeme=n,Object.setPrototypeOf(this,Ye.prototype)}toString(){return`TYPE ERROR: ${this.message}`}}const Ke=new Set(["(",")","+","*","/",",","^",";"]),Je=new Set(["-",":","!","=","<",">","."]);function Ze(e){return/[0-9]/.test(e)}class et{constructor(e){this.cur=0,this.line=1,this.lexemeStart=0,this.tokens=[],this.indentLevels=[],this.source=e,this.indentLevels.push(this.getInitialIndent())}isAtEnd(){return this.cur>=this.source.length}peek(){return this.isAtEnd()?"\0":this.source[this.cur]}peek2(){return this.cur+1>=this.source.length?"\0":this.source[this.cur+1]}advance(){return this.source[this.cur++]}match(e){return this.peek()===e&&(this.cur+=1,!0)}currentLexeme(){return this.source.substring(this.lexemeStart,this.cur)}addToken(e,t=null){this.tokens.push(new He(e,this.currentLexeme(),this.line,t))}scan(){for(;this.cur<this.source.length;)this.lexemeStart=this.cur,this.scanToken();return this.tokens}scanToken(){const e=this.advance();if(Ke.has(e))this.addToken(Qe.get(e));else{if(Je.has(e)){const t=this.peek();if(Qe.has(e+t))return this.cur+=1,void this.addToken(Qe.get(e+t));if(Qe.has(e))return void this.addToken(Qe.get(e))}if("#"!==e)if("\n"!==e){if(" "!==e&&"\r"!==e&&"\t"!==e)if(Ze(e))this.scanNumber();else{if(!function(e){return/[_a-zA-Z]/.test(e)}(e))throw new qe("Unexcpected character: "+e,this.line);this.scanIdentifier()}}else this.scanNewline();else this.scanComment()}}scanComment(){for(;"\n"!=this.peek()&&!this.isAtEnd();)this.cur+=1}getInitialIndent(){let e=this.getIndentLevel();for(;this.match("\n");)e=this.getIndentLevel();return e}getIndentLevel(){let e=0;for(;!this.isAtEnd();){const t=this.peek();if(" "===t)e+=1;else{if("\t"!==t)break;e+=4}this.cur+=1}return e}scanNewline(){this.line+=1;const e=this.indentLevels[this.indentLevels.length-1],t=this.getIndentLevel();if("#"!==this.peek()){if("\n"!==this.peek()&&"\0"!==this.peek())if(this.addToken(Ve.NEWLINE),t>e)this.addToken(Ve.INDENT),this.indentLevels.push(t);else if(t<e){for(;this.indentLevels.length>0&&this.indentLevels[this.indentLevels.length-1]>t;)this.addToken(Ve.DEDENT),this.indentLevels.pop();if(this.indentLevels[this.indentLevels.length-1]!==t)throw new qe("Dedent level doesnt match previous indents",this.line)}}else this.scanComment()}consumeDigits(){for(;Ze(this.peek());)this.cur+=1}scanNumber(){this.consumeDigits(),"."===this.peek()&&"."!==this.peek2()&&(this.cur+=1,this.consumeDigits());const e=Number.parseFloat(this.currentLexeme());"i"===this.peek()?(this.addToken(Ve.LITERAL_IMAG,e),this.cur+=1):this.addToken(Ve.LITERAL_REAL,e)}scanIdentifier(){for(;e=this.peek(),/[_a-zA-Z0-9]/.test(e);)this.cur+=1;var e;const t=this.currentLexeme();"i"===t?this.addToken(Ve.LITERAL_IMAG,1):Qe.has(t)?this.addToken(Qe.get(t)):this.addToken(Ve.IDENTIFIER,t)}}var tt,nt;!function(e){e[e.Literal=0]="Literal",e[e.Unary=1]="Unary",e[e.Binary=2]="Binary",e[e.Grouping=3]="Grouping",e[e.Variable=4]="Variable",e[e.FuncCall=5]="FuncCall",e[e.StmtList=6]="StmtList",e[e.Declaration=7]="Declaration",e[e.Assignment=8]="Assignment",e[e.For=9]="For",e[e.While=10]="While",e[e.If=11]="If",e[e.FuncDef=12]="FuncDef",e[e.Return=13]="Return",e[e.Break=14]="Break"}(tt||(tt={})),function(e){e[e.Bool=0]="Bool",e[e.Real=1]="Real",e[e.Imag=2]="Imag"}(nt||(nt={}));const rt=new Map([[nt.Real,"float"],[nt.Imag,"vec2"],[nt.Bool,"bool"]]),st=new Map([["float",nt.Real],["vec2",nt.Imag],["bool",nt.Bool]]),it=new He(Ve.EOF,null,-1);class ot{constructor(e){this.cur=0,this.tokens=e}error(e){const t=this.isAtEnd()?this.prev():this.peek();throw new qe(e,t.line,t.lexeme)}isAtEnd(){return this.cur>=this.tokens.length}peek(){return this.isAtEnd()?it:this.tokens[this.cur]}prev(){return this.tokens[this.cur-1]}backup(){this.cur-=1}advance(){return this.isAtEnd()?it:this.tokens[this.cur++]}match(e,t=!0){const n=this.peek();return!!e.some((e=>n.type===e))&&(!t||this.advance())}matchOrError(e,t){const n=this.match(e);if(n)return n;this.error(t)}parse(){return this.stmtList()}stmtList(){let e=[];for(;!this.isAtEnd()&&this.peek().type!==Ve.DEDENT;)e.push(this.statement());return{nodeType:tt.StmtList,statements:e}}statement(){let e;switch(this.peek().type){case Ve.IDENTIFIER:e=this.assignmentOrDeclarationOrFuncdef();break;case Ve.IF:this.advance(),e=this.ifStmt();break;case Ve.FOR:this.advance(),e=this.forStmt();break;case Ve.WHILE:this.advance(),e=this.whileStmt();break;case Ve.RETURN:this.advance(),e=this.returnStmt();break;case Ve.BREAK:this.advance(),e=this.breakStmt();break;case Ve.INDENT:this.error("Unexpected indent");default:this.error("Excpected statement")}return[tt.If,tt.For,tt.While,tt.FuncDef].includes(e.nodeType)||this.matchOrError([Ve.NEWLINE,Ve.SEMICOLON,Ve.EOF],"Unexcpected token "+this.peek().lexeme),e}indentedBlock(){this.matchOrError([Ve.INDENT],"Excpected indent");const e=this.stmtList();return this.matchOrError([Ve.DEDENT,Ve.EOF],"Expected dedent"),e}indentedBlockOrOnelineStmt(){return this.match([Ve.NEWLINE])?this.indentedBlock():{nodeType:tt.StmtList,statements:[this.statement()]}}assignmentOrDeclarationOrFuncdef(){const e=this.advance().lexeme;if(this.match([Ve.LPAREN]))return this.functionDefinition(e);const t=this.matchOrError([Ve.EQUAL,Ve.COLON_EQUAL],"Excpected assignment or declaration"),n=this.expression();return t.type===Ve.EQUAL?{nodeType:tt.Assignment,name:e,value:n}:{nodeType:tt.Declaration,name:e,value:n}}identifier(){return this.matchOrError([Ve.IDENTIFIER],"Expected identifier"),this.prev().lexeme}parameterList(){if(this.match([Ve.RPAREN]))return[];let e=[this.identifier()];for(;!this.match([Ve.RPAREN]);)this.matchOrError([Ve.COMMA],"Expected ',' or ')' in parameter list"),e.push(this.identifier());return e}argumentList(){if(this.match([Ve.RPAREN]))return[];let e=[this.expression()];for(;!this.match([Ve.RPAREN]);)this.matchOrError([Ve.COMMA],"Expected ',' or ')' in argument list"),e.push(this.expression());return e}functionDefinition(e){let t,n=this.parameterList();if(this.matchOrError([Ve.COLON_EQUAL],"Expected ':=' in function definition"),this.match([Ve.NEWLINE]))t=this.indentedBlock();else{let e={nodeType:tt.Return,value:this.expression()};t={nodeType:tt.StmtList,statements:[e]},this.matchOrError([Ve.NEWLINE,Ve.SEMICOLON,Ve.EOF],"Unexcpected token "+this.peek().lexeme)}return{nodeType:tt.FuncDef,name:e,params:n,body:t}}ifStmt(){const e=this.expression();this.matchOrError([Ve.COLON],"Excpected ':' in if-statement");const t=this.indentedBlockOrOnelineStmt();let n;return this.match([Ve.ELIF])?n={nodeType:tt.StmtList,statements:[this.ifStmt()]}:this.match([Ve.ELSE])&&(this.matchOrError([Ve.COLON],"Expected ':' after else"),n=this.indentedBlockOrOnelineStmt()),{nodeType:tt.If,condition:e,mainBranch:t,elseBranch:n}}whileStmt(){const e=this.expression();this.matchOrError([Ve.COLON],"Excpected ':' in while-statement");const t=this.indentedBlockOrOnelineStmt();return{nodeType:tt.While,condition:e,body:t}}forStmt(){const e=this.matchOrError([Ve.IDENTIFIER],"Expected identifier in for-statement").literal;this.matchOrError([Ve.EQUAL],"Expected '=' in for-statement");const t=this.expression();this.matchOrError([Ve.DOUBLE_DOT],"Expected range (start..end..[step])");const n=this.expression();let r={nodeType:tt.Literal,value:1,dataType:nt.Real};this.match([Ve.DOUBLE_DOT])&&(r=this.expression()),this.matchOrError([Ve.COLON],"Excpected ':' in for-statement");const s=this.indentedBlockOrOnelineStmt();return{nodeType:tt.For,loopvar:e,start:t,end:n,step:r,body:s}}returnStmt(){const e=this.expression();return{nodeType:tt.Return,value:e}}breakStmt(){return{nodeType:tt.Break}}expression(){return this.logical()}_binary(e,t){let n=t();for(;this.match(e);){const e=this.prev(),r=t();n={nodeType:tt.Binary,left:n,op:e,right:r}}return n}logical(){return this._binary([Ve.AND,Ve.OR],(()=>this.equality()))}equality(){return this._binary([Ve.EQUAL_EQUAL,Ve.BANG_EQUAL],(()=>this.comparision()))}comparision(){return this._binary([Ve.LESS,Ve.LESS_EQUAL,Ve.GREATER,Ve.GREATER_EQUAL],(()=>this.term()))}term(){return this._binary([Ve.PLUS,Ve.MINUS],(()=>this.factor()))}factor(){return this._binary([Ve.STAR,Ve.SLASH],(()=>this.unary()))}unary(){if(this.match([Ve.MINUS,Ve.BANG])){const e=this.prev(),t=this.unary();return{nodeType:tt.Unary,op:e,expr:t}}return this.implicitMultiplication()}implicitMultiplication(){if(this.match([Ve.LITERAL_IMAG,Ve.LITERAL_REAL,Ve.LPAREN,Ve.IDENTIFIER],!1)){let e=this.power();for(;this.match([Ve.LPAREN,Ve.IDENTIFIER],!1);){let t=this.power();e={nodeType:tt.Binary,op:new He(Ve.STAR,"*",-1),left:e,right:t}}return e}return this.power()}power(){return this._binary([Ve.CARET],(()=>this.functionCall()))}functionCall(){const e=this.primary();if(e.nodeType===tt.Variable&&this.match([Ve.LPAREN])){const t=this.argumentList();return{nodeType:tt.FuncCall,callee:e,args:t}}return e}_grouping(){const e=this.expression();return this.matchOrError([Ve.RPAREN],"Unmatched opening parenthesis"),{nodeType:tt.Grouping,expr:e}}primary(){return this.match([Ve.TRUE])?{nodeType:tt.Literal,value:!0,dataType:nt.Bool}:this.match([Ve.FALSE])?{nodeType:tt.Literal,value:!1,dataType:nt.Bool}:this.match([Ve.LITERAL_REAL])?{nodeType:tt.Literal,value:this.prev().literal,dataType:nt.Real}:this.match([Ve.LITERAL_IMAG])?{nodeType:tt.Literal,value:this.prev().literal,dataType:nt.Imag}:this.match([Ve.IDENTIFIER])?{nodeType:tt.Variable,name:this.prev().literal}:this.match([Ve.LPAREN])?this._grouping():void this.error("Expected expression")}}function at(e,t){return 0===t?[[]]:e.flatMap((n=>at(e,t-1).map((e=>[n].concat(e)))))}function ct(e,t){return e.length===t.length&&JSON.stringify(e)==JSON.stringify(t)}const lt=" ".repeat(4);class ut{constructor(e){this.indentLevel=0,this.tree=e}_indentStr(){return lt.repeat(this.indentLevel)}_bracedBlock(e){this.indentLevel+=1;const t=this.stmtList(e);return this.indentLevel-=1,`{\n${t}\n${this._indentStr()}}`}_number(e){let t=e.toString();return t.includes(".")?t:t+".0"}transform(e=this.tree){switch(e.nodeType){case tt.StmtList:return this.stmtList(e);case tt.Declaration:return this.declaration(e);case tt.Assignment:return this.assignment(e);case tt.If:return this.if(e);case tt.For:return this.for(e);case tt.While:return this.while(e);case tt.FuncDef:return this.funcDef(e);case tt.Break:return this.break(e);case tt.Return:return this.return(e);case tt.Grouping:return this.grouping(e);case tt.Binary:return this.binary(e);case tt.Unary:return this.unary(e);case tt.Literal:return this.literal(e);case tt.Variable:return e.name;case tt.FuncCall:return this.funcCall(e)}}stmtList(e){let t=[];for(let n of e.statements){let e=this.transform(n);e.endsWith("}")||(e+=";"),t.push(e)}return this._indentStr()+t.join("\n"+this._indentStr())}declaration(e){return`${rt.get(e.value.dataType)} ${e.name} = ${this.transform(e.value)}`}assignment(e){return`${e.name} = ${this.transform(e.value)}`}if(e){let t=`if (${this.transform(e.condition)}) ${this._bracedBlock(e.mainBranch)}`;return e.elseBranch&&(t+=` else ${this._bracedBlock(e.elseBranch)}`),t}for(e){let{loopvar:t,start:n,end:r,step:s,body:i}=e;return`for (float ${t} = ${this.transform(n)}; ${t} <= ${this.transform(r)}; ${t} += ${this.transform(s)}) ${this._bracedBlock(i)}`}while(e){return`while (${this.transform(e.condition)}) ${this._bracedBlock(e.body)}`}funcDef(e){let{name:t,params:n,body:r,dataType:s}=e,i=rt.get(s),o=[];for(let e of at(["vec2"],n.length)){let s=`${i} ${t}(${n.map(((t,n)=>e[n]+" "+t)).join(", ")}) ${this._bracedBlock(r)}`;o.push(s)}return o.join("\n")}break(e){return"break"}return(e){return`return ${this.transform(e.value)}`}grouping(e){return`(${this.transform(e.expr)})`}binary(e){const t=this.transform(e.left),n=this.transform(e.right),r=e.left.dataType,s=e.right.dataType,i=e.op.lexeme,o=`${t} ${i} ${n}`;switch(i){case"-":case"+":return r===nt.Real&&s===nt.Imag?`vec2(${t}, 0.0) ${i} ${n}`:r===nt.Imag&&s===nt.Real?`${t} ${i} vec2(${n}, 0.0)`:o;case"*":return r===nt.Imag&&s===nt.Imag?`Mul(${t}, ${n})`:o;case"/":return s===nt.Real?o:`Div(${t}, ${n})`;case"^":return"e"===t?`Exp(${n})`:`Pow(${t}, ${n})`;case"<":case">":case"<=":case">=":return o}}unary(e){return`${e.op.lexeme}${this.transform(e.expr)}`}funcCall(e){const t=e.args.map((e=>this.transform(e)));return`${e.callee.name}(${t.join(", ")})`}literal(e){const{dataType:t,value:n}=e;switch(t){case nt.Bool:return!0===n?"true":"false";case nt.Real:return this._number(n);case nt.Imag:return`vec2(0.0, ${this._number(n)})`}}}const ht=new Map(Object.entries({e:{type:nt.Real,value:Math.exp(1)},pi:{type:nt.Real,value:Math.PI}})),dt={Re_Re_or_Re_Im:[{out:nt.Real,in:[nt.Real]},{out:nt.Real,in:[nt.Imag]}],Re_Re_or_Im_Im:[{out:nt.Real,in:[nt.Real]},{out:nt.Imag,in:[nt.Imag]}]},mt=new Map(Object.entries({re:{glslName:"Re",signatures:dt.Re_Re_or_Re_Im},im:{glslName:"Im",signatures:dt.Re_Re_or_Re_Im},abs:{glslName:"Abs",signatures:dt.Re_Re_or_Re_Im},arg:{glslName:"Arg",signatures:dt.Re_Re_or_Re_Im},conj:{glslName:"Conj",signatures:dt.Re_Re_or_Im_Im},exp:{glslName:"Exp",signatures:dt.Re_Re_or_Im_Im},log:{glslName:"Log",signatures:dt.Re_Re_or_Im_Im},sqrt:{glslName:"Sqrt",signatures:dt.Re_Re_or_Im_Im},sin:{glslName:"Sin",signatures:dt.Re_Re_or_Im_Im},cos:{glslName:"Cos",signatures:dt.Re_Re_or_Im_Im},tan:{glslName:"Tan",signatures:dt.Re_Re_or_Im_Im},arctan:{glslName:"Arctan",signatures:dt.Re_Re_or_Im_Im},arcsin:{glslName:"Arcsin",signatures:dt.Re_Re_or_Im_Im},arccos:{glslName:"Arccos",signatures:dt.Re_Re_or_Im_Im}}));class ft{constructor(e,t){this.insideFuncDef=!1,this.tree=e,this.currentScope={env:t||new Map,parent:null},this.declaredFunctions=new Map}withNewScope(e){const t=this.currentScope;this.currentScope={env:new Map,parent:t};const n=e();return this.currentScope=t,n}lookupVar(e){let t=this.currentScope;for(;t;){const n=t.env.get(e);if(n)return n;t=t.parent}return ht.get(e)}declareVar(e,t){(ht.has(e)||this.currentScope.env.has(e))&&this.error(`Cannot redeclare variable ${e}`),this.currentScope.env.set(e,{type:t})}error(e){throw new Ye(e)}assertType(e,t,n){e.forEach((e=>{t.includes(e)||this.error(n)}))}assertNumeric(e,t){this.assertType(e,[nt.Real,nt.Imag],t)}assertBool(e,t){this.assertType(e,[nt.Bool],t)}typecheckTree(){this.typecheck(this.tree);let e=this.declaredFunctions.get(pt.mainFunctionName);e||this.error("Must declare a main function f(z)");const t={in:[nt.Imag],out:nt.Imag};console.log(e.signatures,[t]),ct(e.signatures,[t])||this.error("Main function must be of type Imag -> Imag")}typecheck(e){let t;switch(e.nodeType){case tt.StmtList:t=this.stmtList(e);break;case tt.Declaration:t=this.declaration(e);break;case tt.Assignment:t=this.assignment(e);break;case tt.If:t=this.if(e);break;case tt.For:t=this.for(e);break;case tt.While:t=this.while(e);break;case tt.FuncDef:t=this.funcDef(e);break;case tt.Break:return;case tt.Return:t=this.return(e);break;case tt.Grouping:t=this.grouping(e);break;case tt.Binary:t=this.binary(e);break;case tt.Unary:t=this.unary(e);break;case tt.Literal:t=this.literal(e);break;case tt.Variable:t=this.variable(e);break;case tt.FuncCall:t=this.funcCall(e)}return e.dataType=t,t}stmtList(e){e.statements.forEach(this.typecheck.bind(this))}declaration(e){const t=this.typecheck(e.value);this.declareVar(e.name,t)}assignment(e){ht.has(e.name)&&this.error(`Cannot reassign builtin variable ${e.name}`);let t=this.lookupVar(e.name);t||this.error(`Cannot assign to undeclared variable ${e.name}`);const n=this.typecheck(e.value);t.type!==n&&this.error(`Cannot reassign ${e.name} from type ${nt[t.type]} to ${nt[n]}`)}if(e){this.assertType([this.typecheck(e.condition)],[nt.Bool],"Condition in if-statement is not of type Bool"),this.withNewScope((()=>this.typecheck(e.mainBranch))),e.elseBranch&&this.withNewScope((()=>this.typecheck(e.elseBranch)))}for(e){const[t,n,r]=[e.start,e.end,e.step].map((e=>this.typecheck(e)));this.assertType([t,n,r],[nt.Real],"For-loop bounds are not of type Real"),this.withNewScope((()=>{this.declareVar(e.loopvar,nt.Real),this.typecheck(e.body)}))}while(e){this.assertType([this.typecheck(e.condition)],[nt.Bool],"Condition in while-loop is not of type Bool"),this.withNewScope((()=>this.typecheck(e.body)))}funcDef(e){(this.declaredFunctions.has(e.name)||mt.has(e.name))&&this.error(`Cannot redeclare function ${e.name}`),this.insideFuncDef=!0,this.currentFunction={name:e.name,returnType:null};const t=e.params.map((e=>nt.Imag));this.withNewScope((()=>{e.params.forEach(((e,n)=>this.declareVar(e,t[n]))),this.typecheck(e.body)}));const n=this.currentFunction.returnType;n||this.error(`Function ${e.name} doesnt return a value`);const r={in:t,out:n};return this.declaredFunctions.set(e.name,{signatures:[r]}),this.insideFuncDef=!1,n}return(e){const t=this.typecheck(e.value);this.currentFunction.returnType&&this.currentFunction.returnType!==t&&this.error(`Function ${this.currentFunction.name} has multiple possible return types`),this.currentFunction.returnType=t}grouping(e){return this.typecheck(e.expr)}binary(e){const{left:t,right:n,op:r}=e,s=this.typecheck(t),i=this.typecheck(n);return["+","-","*","/","^"].includes(r.lexeme)?(this.assertNumeric([s,i],`Wrong operand types for ${r.lexeme}: ${nt[s]}, ${nt[i]}`),s===nt.Real&&i===nt.Real?nt.Real:nt.Imag):["<",">","<=",">="].includes(r.lexeme)?(this.assertType([s,i],[nt.Real],`Wrong operand types for ${r.lexeme}: ${nt[s]}, ${nt[i]}`),nt.Bool):void 0}unary(e){const t=this.typecheck(e.expr),n=e.op.lexeme,r=`Wrong operand type for unary ${n}: ${nt[t]}`;return"-"===n&&this.assertNumeric([t],r),"!"===n&&this.assertBool([t],r),t}literal(e){return console.assert(void 0!==e.dataType),e.dataType}variable(e){let t=this.lookupVar(e.name);return t||this.error(`Undeclared variable ${e.name}`),t.type}funcCall(e){let t=e.callee.name,n=mt.get(t);n?e.callee.name=n.glslName:n=this.declaredFunctions.get(t),n||this.error(`Undeclared function ${t}`);const r=e.args.map((e=>this.typecheck(e)));for(let e of n.signatures)if(ct(e.in,r))return e.out;this.error(`Wrong argument types for ${t}: [${r.map((e=>nt[e])).join(", ")}]`)}}const pt={maxFunctionParams:5,mainFunctionName:"f"};class gt{constructor(e,t){var n;this.mousePos={x:0,y:0},this.defaultSettings=new Map(Object.entries({showGrid:{type:"bool",value:!1},gridSpacing:{type:"float",value:1},showModContours:{type:"bool",value:!0},showPhaseContours:{type:"bool",value:!1}})),this.settings=(n=this.defaultSettings,new Map(JSON.parse(JSON.stringify(Object.entries(Object.fromEntries(n.entries())))))),this.c=e,this.mousePos={x:0,y:0},this.defaultWorkspace=t,We.set(t.vars),this.compileUserCodeToGlsl(t.code,!1)}updateSetting(e,t,n=!0){if(!this.settings.has(e))throw new Error(`setting ${e} doesnt exist`);this.settings.get(e).value=t,this.mainProgram.setUniformValue(`u_${e}`,t),n&&this.render()}addUniform(e,t=null,n="float"){this.mainProgram.addUniform(new Te(e,n)),this.compProgram.addUniform(new Te(e,n)),this.setUniformValue(e,t)}deleteUniform(e){this.mainProgram.deleteUniform(e),this.compProgram.deleteUniform(e)}setUniformValue(e,t){this.mainProgram.setUniformValue(e,t),this.compProgram.setUniformValue(e,t)}addUniformsFromWorkspace(e){e.vars.forEach((e=>{"float"===e.type&&this.addUniform(e.name,e.value,"float"),"vec2"===e.type&&this.addUniform(e.name,[e.x,e.y],"vec2")}))}loadNewWorkSpace(e){c(We).forEach((e=>this.deleteUniform(e.name))),We.set(e.vars),this.addUniformsFromWorkspace(e),this.compileUserCodeToGlsl(e.code,!0)}recompilePrograms(){console.log(this.mainProgram.uniforms);try{this.mainProgram.recompile(this.userCodeGlsl),this.compProgram.recompile(this.userCodeGlsl)}catch(e){return void Ge.set([e])}Ge.set([]),this.render()}compileUserCodeToGlsl(e,t=!0){const n=new Map(c(We).map((e=>[e.name,e.type])));console.log(n);const r=function(e,t,n=!1){let r,s,i,o=[];try{r=new et(e).scan(),s=new ot(r).parse();const o=new Map;for(const[e,n]of t.entries())o.set(e,{type:st.get(n)});let a=new ft(s,o);n||a.typecheckTree(),i=new ut(s).transform()}catch(e){if(!(e instanceof Xe))throw console.error("Internal compiler error"),e;o.push(e)}return{tokens:r,astTree:s,glslString:i,errors:o}}(e,n);console.log("compiler output: ",r),r.errors.length>0?Ge.set(r.errors):(Ge.set([]),this.userCodeGlsl=r.glslString,t&&this.recompilePrograms())}computeFval(e){const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.compFbo),t.useProgram(this.compProgram.id),this.compProgram.setUniformValue("u_point",[e.x,e.y]),this.compProgram.bindAllUniforms(),t.viewport(0,0,this.c.width,this.c.height),t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.POINTS,0,1);let n=new Float32Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,n),t.bindFramebuffer(t.FRAMEBUFFER,null),{x:n[0],y:n[1]}}render(e=!0){const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.useProgram(this.mainProgram.id),this.mainProgram.setUniformValue("u_worldMat",this.camera.getWorldMatrix()),this.mainProgram.setUniformValue("u_mouse",[this.mousePos.x,this.mousePos.y]),this.mainProgram.setUniformValue("u_resolution",[this.c.width,this.c.height]),this.mainProgram.setUniformValue("u_scale",[this.camera.scale.x,this.camera.scale.y]),this.mainProgram.bindAllUniforms(),t.viewport(0,0,this.c.width,this.c.height),t.clearColor(.42,.42,1,1),t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,6),e||requestAnimationFrame((()=>this.render(e)))}init(e){return $e(this,void 0,void 0,(function*(){const t=this.c;Ae(t);const n=t.getContext("webgl2");if(!n)return void e("No WebGL2 context");if(this.gl=n,this.camera=new Le(t,{setEventListeners:!1}),!n.getExtension("EXT_color_buffer_float"))return void e("EXT_color_buffer_float not supported");let r=new Ue(n,[new Te("u_worldMat","mat3"),new Te("u_mouse","vec2"),new Te("u_resolution","vec2"),new Te("u_scale","vec2")]);this.settings.forEach(((e,t)=>{r.addUniform(new Te(`u_${t}`,e.type,e.value))})),this.mainProgram=r;let s=new Ue(n,[new Te("u_point","vec2")]);if(this.compProgram=s,this.addUniformsFromWorkspace(this.defaultWorkspace),yield r.compileFromUrls("shaders/vertex.glsl","shaders/fragment.glsl",this.userCodeGlsl),yield s.compileFromUrls("shaders/vertex-comp.glsl","shaders/fragment-comp.glsl",this.userCodeGlsl),!r||!s)return;const i=n.getAttribLocation(r.id,"a_position");!function(e,t){let n=e.createBuffer(),r=e.createVertexArray();e.bindVertexArray(r),e.enableVertexAttribArray(t),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW),e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0)}(n,i);let o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o);let a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.RGBA32F,1,1,0,n.RGBA,n.FLOAT,null),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0),this.compFbo=o}))}}function vt(t){let n,r,s,i,o,a,c,l,u=yt(t[0])+"",h=yt(t[1])+"";return{c(){n=S("div"),r=S("p"),s=R("   z = "),i=R(u),o=L(),a=S("p"),c=R("f(z) = "),l=R(h),k(r,"class","svelte-1qvof95"),k(a,"class","svelte-1qvof95"),k(n,"id","coordinate-box"),k(n,"class","svelte-1qvof95")},m(e,t){E(e,n,t),v(n,r),v(r,s),v(r,i),v(n,o),v(n,a),v(a,c),v(a,l)},p(e,[t]){1&t&&u!==(u=yt(e[0])+"")&&_(i,u),2&t&&h!==(h=yt(e[1])+"")&&_(l,h)},i:e,o:e,d(e){e&&x(n)}}}function yt(e){return e.y<0?`${bt(e.x)} - ${bt(-e.y)}i`:`${bt(e.x)} + ${bt(e.y)}i`}function bt(e){return Math.abs(e)<.001||Math.abs(e)>=1e3?e.toExponential(3):e.toFixed(3)}function Et(e,t,n){let{mouse:r}=t,{fval:s}=t;return e.$$set=e=>{"mouse"in e&&n(0,r=e.mouse),"fval"in e&&n(1,s=e.fval)},[r,s]}class xt extends xe{constructor(e){super(),Ee(this,e,Et,vt,o,{mouse:0,fval:1})}}function $t(e,t,n){const r=e.slice();return r[3]=t[n],r}function St(e){let t,n,r,s,i,o=e[3].name+"";function a(){return e[2](e[3])}return{c(){t=S("button"),n=R(o),r=L(),k(t,"class","tab svelte-o94sru"),I(t,"active",e[3].id==e[0].id)},m(e,o){E(e,t,o),v(t,n),v(t,r),s||(i=A(t,"click",a),s=!0)},p(r,s){e=r,2&s&&o!==(o=e[3].name+"")&&_(n,o),3&s&&I(t,"active",e[3].id==e[0].id)},d(e){e&&x(t),s=!1,i()}}}function Rt(t){let n,r=t[1],s=[];for(let e=0;e<r.length;e+=1)s[e]=St($t(t,r,e));return{c(){n=S("div");for(let e=0;e<s.length;e+=1)s[e].c();k(n,"id","navbar"),k(n,"class","svelte-o94sru")},m(e,t){E(e,n,t);for(let e=0;e<s.length;e+=1)s[e].m(n,null)},p(e,[t]){if(3&t){let i;for(r=e[1],i=0;i<r.length;i+=1){const o=$t(e,r,i);s[i]?s[i].p(o,t):(s[i]=St(o),s[i].c(),s[i].m(n,null))}for(;i<s.length;i+=1)s[i].d(1);s.length=r.length}},i:e,o:e,d(e){e&&x(n),$(s,e)}}}function Lt(e,t,n){let{tabs:r}=t,{activeTab:s}=t;return e.$$set=e=>{"tabs"in e&&n(1,r=e.tabs),"activeTab"in e&&n(0,s=e.activeTab)},[s,r,e=>n(0,s=e)]}class wt extends xe{constructor(e){super(),Ee(this,e,Lt,Rt,o,{tabs:1,activeTab:0})}}const At={identity:"f(z) := z",juliaSetStandard:"g(z) := z^2 + c\n\nf(z) := \n  for j = 1..N: z = g(z)\n  return z",juliaSetBurningShip:"g(z) := (abs(re(z)) + i abs(im(z)))^x + c\n\nf(z) := \n  for j = 1..N: z = g(z)\n  return z",mandelbrotStandard:"g(z, c) := z^x + c\n\nf(c) := \n  w := 0 + 0i\n  for j = 1..N: \n    if abs(w) > 2: break\n    w = g(w, c)\n  return w"};function kt(e,t,n=-10,r=10,s=.001){return{id:Be(),type:"float",name:e,value:t,min:n,max:r,step:s}}function Tt(e,t=0,n=0,r=ze()){return{id:Be(),type:"vec2",name:e,x:t,y:n,color:r}}const _t={identity:{code:At.identity,vars:[]},juliaSetStandard:{code:At.juliaSetStandard,vars:[kt("N",50,0,100,1),Tt("c",.272,.575)]},juliaSetBurningShip1:{code:At.juliaSetBurningShip,vars:[kt("N",100,0,100,1),Tt("c",-.128,-.847),kt("x",2)]},juliaSetBurningShip2:{code:At.juliaSetBurningShip,vars:[kt("N",100,0,100,1),Tt("c",-.371,.412),kt("x",-1.46939)]},mandelbrotStandard:{code:At.mandelbrotStandard,vars:[kt("N",100,0,100,1),kt("x",2)]}},Ut="juliaSetBurningShip1";function Nt(e){const t=e-1;return t*t*t+1}function It(e,{delay:n=0,duration:r=400,easing:s=t}={}){const i=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:s,css:e=>"opacity: "+e*i}}function Ot(e,{delay:t=0,duration:n=400,easing:r=Nt,x:s=0,y:i=0,opacity:o=0}={}){const a=getComputedStyle(e),c=+a.opacity,l="none"===a.transform?"":a.transform,u=c*(1-o);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${l} translate(${(1-e)*s}px, ${(1-e)*i}px);\n\t\t\topacity: ${c-u*t}`}}function Ft(e,t,n){const r=e.slice();return r[16]=t[n],r[18]=n,r}function Ct(e,t,n){const r=e.slice();return r[19]=t[n][0],r[20]=t[n][1],r}function Bt(e){let t,n,r,s=Object.entries(_t),i=[];for(let t=0;t<s.length;t+=1)i[t]=Dt(Ct(e,s,t));return{c(){t=S("div");for(let e=0;e<i.length;e+=1)i[e].c();k(t,"id","examples-container"),k(t,"class","svelte-1m00x31")},m(e,n){E(e,t,n);for(let e=0;e<i.length;e+=1)i[e].m(t,null);r=!0},p(e,n){if(272&n){let r;for(s=Object.entries(_t),r=0;r<s.length;r+=1){const o=Ct(e,s,r);i[r]?i[r].p(o,n):(i[r]=Dt(o),i[r].c(),i[r].m(t,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=s.length}},i(e){r||(Y((()=>{n||(n=de(t,It,{duration:100},!0)),n.run(1)})),r=!0)},o(e){n||(n=de(t,It,{duration:100},!1)),n.run(0),r=!1},d(e){e&&x(t),$(i,e),e&&n&&n.end()}}}function Dt(e){let t,n,r,s,i=e[19]+"";function o(){return e[14](e[19],e[20])}return{c(){t=S("button"),n=R(i),k(t,"class","svelte-1m00x31"),I(t,"selected",e[19]===e[4])},m(e,i){E(e,t,i),v(t,n),r||(s=A(t,"click",o),r=!0)},p(n,r){e=n,16&r&&I(t,"selected",e[19]===e[4])},d(e){e&&x(t),r=!1,s()}}}function Mt(e){let t,n=e[6],r=[];for(let t=0;t<n.length;t+=1)r[t]=zt(Ft(e,n,t));return{c(){t=S("div");for(let e=0;e<r.length;e+=1)r[e].c();k(t,"id","error-div"),k(t,"class","svelte-1m00x31")},m(e,n){E(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,s){if(64&s){let i;for(n=e[6],i=0;i<n.length;i+=1){const o=Ft(e,n,i);r[i]?r[i].p(o,s):(r[i]=zt(o),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},d(e){e&&x(t),$(r,e)}}}function zt(e){let t,n,r=e[16].toString()+"";return{c(){t=S("p"),n=R(r),k(t,"class","svelte-1m00x31")},m(e,r){E(e,t,r),v(t,n)},p(e,t){64&t&&r!==(r=e[16].toString()+"")&&_(n,r)},d(e){e&&x(t)}}}function Pt(e){let t,n,r,s;return{c(){t=S("span"),t.textContent="Transpiled glsl:",n=L(),r=S("pre"),s=R(e[2]),N(t,"color","var(--c-white)"),k(r,"id","glsl-output"),k(r,"class","svelte-1m00x31")},m(e,i){E(e,t,i),E(e,n,i),E(e,r,i),v(r,s)},p(e,t){4&t&&_(s,e[2])},d(e){e&&x(t),e&&x(n),e&&x(r)}}}function jt(e){let t,n,r,i,o,a,c,l,u,h,d,m,f,p,g,y,b,$=e[5]&&Bt(e),T=e[6].length>0&&Mt(e),U=e[3]&&Pt(e);return{c(){t=S("div"),n=S("button"),n.textContent="Show glsl",r=L(),i=S("button"),i.textContent="Reset",o=L(),a=S("div"),c=S("button"),c.textContent="Examples",l=L(),$&&$.c(),u=L(),h=S("pre"),d=R(e[0]),m=L(),T&&T.c(),f=L(),U&&U.c(),p=w(),k(n,"class","svelte-1m00x31"),I(n,"selected",e[3]),k(i,"class","svelte-1m00x31"),k(c,"class","svelte-1m00x31"),I(c,"selected",e[5]),k(a,"id","tooltip-container"),k(a,"class","svelte-1m00x31"),k(t,"id","buttons-div"),k(t,"class","svelte-1m00x31"),k(h,"id","editor"),k(h,"contenteditable","true"),k(h,"class","svelte-1m00x31"),I(h,"error",e[6].length>0)},m(s,x){E(s,t,x),v(t,n),v(t,r),v(t,i),v(t,o),v(t,a),v(a,c),v(a,l),$&&$.m(a,null),E(s,u,x),E(s,h,x),v(h,d),e[15](h),E(s,m,x),T&&T.m(s,x),E(s,f,x),U&&U.m(s,x),E(s,p,x),g=!0,y||(b=[A(n,"click",e[11]),A(i,"click",e[12]),A(c,"click",e[13]),A(h,"input",e[9]),A(h,"keydown",Gt)],y=!0)},p(e,[t]){(!g||8&t)&&I(n,"selected",e[3]),(!g||32&t)&&I(c,"selected",e[5]),e[5]?$?($.p(e,t),32&t&&le($,1)):($=Bt(e),$.c(),le($,1),$.m(a,null)):$&&(ae(),ue($,1,1,(()=>{$=null})),ce()),(!g||1&t)&&_(d,e[0]),(!g||64&t)&&I(h,"error",e[6].length>0),e[6].length>0?T?T.p(e,t):(T=Mt(e),T.c(),T.m(f.parentNode,f)):T&&(T.d(1),T=null),e[3]?U?U.p(e,t):(U=Pt(e),U.c(),U.m(p.parentNode,p)):U&&(U.d(1),U=null)},i(e){g||(le($),g=!0)},o(e){ue($),g=!1},d(n){n&&x(t),$&&$.d(),n&&x(u),n&&x(h),e[15](null),n&&x(m),T&&T.d(n),n&&x(f),U&&U.d(n),n&&x(p),y=!1,s(b)}}}function Gt(e){"Tab"===e.key&&e.preventDefault()}function Wt(e,t,n){let r;l(e,Ge,(e=>n(6,r=e)));let s,{canvas:i}=t,{code:o}=t,a=i.userCodeGlsl,c=!1,u=Ut;const h=o;let d=!1;function m(e,t){console.log("select",e,t),n(4,u=e),n(0,o=t.code),i.loadNewWorkSpace(t)}document.addEventListener("click",(e=>{!d||e.target.closest("#examples-container")||e.target.closest("#tooltip-container")||n(5,d=!1)}));return e.$$set=e=>{"canvas"in e&&n(10,i=e.canvas),"code"in e&&n(0,o=e.code)},[o,s,a,c,u,d,r,h,m,function(e){n(0,o=e.target.innerText),i.compileUserCodeToGlsl(o,!0),n(2,a=i.userCodeGlsl),r.forEach((e=>console.error(e.toString())))},i,()=>n(3,c=!c),()=>n(0,o=h),()=>n(5,d=!d),(e,t)=>m(e,t),function(e){V[e?"unshift":"push"]((()=>{s=e,n(1,s)}))}]}class Vt extends xe{constructor(e){super(),Ee(this,e,Wt,jt,o,{canvas:10,code:0})}}function Qt(e){let t,n,r;return{c(){t=S("input"),k(t,"type","number"),k(t,"step",e[2]),k(t,"class","svelte-12nxz13")},m(s,i){E(s,t,i),U(t,e[0]),n||(r=[A(t,"input",e[6]),A(t,"input",e[4])],n=!0)},p(e,n){4&n&&k(t,"step",e[2]),1&n&&T(t.value)!==e[0]&&U(t,e[0])},d(e){e&&x(t),n=!1,s(r)}}}function Ht(e){let t,n,r;return{c(){t=S("input"),k(t,"type","text"),k(t,"class","svelte-12nxz13")},m(s,i){E(s,t,i),U(t,e[0]),n||(r=[A(t,"input",e[5]),A(t,"input",e[3])],n=!0)},p(e,n){1&n&&t.value!==e[0]&&U(t,e[0])},d(e){e&&x(t),n=!1,s(r)}}}function Xt(t){let n,r,s,i;function o(e,t){return"text"===e[1]?Ht:"number"===e[1]?Qt:void 0}let a=o(t),c=a&&a(t);return{c(){n=S("div"),r=S("span"),s=R(t[0]),i=L(),c&&c.c(),k(r,"class","svelte-12nxz13"),k(n,"id","container"),k(n,"class","svelte-12nxz13")},m(e,t){E(e,n,t),v(n,r),v(r,s),v(n,i),c&&c.m(n,null)},p(e,[t]){1&t&&_(s,e[0]),a===(a=o(e))&&c?c.p(e,t):(c&&c.d(1),c=a&&a(e),c&&(c.c(),c.m(n,null)))},i:e,o:e,d(e){e&&x(n),c&&c.d()}}}function qt(e,t,n){let{type:r}=t,{value:s}=t,{step:i=.001}=t;return e.$$set=e=>{"type"in e&&n(1,r=e.type),"value"in e&&n(0,s=e.value),"step"in e&&n(2,i=e.step)},[s,r,i,function(t){G.call(this,e,t)},function(t){G.call(this,e,t)},function(){s=this.value,n(0,s)},function(){s=T(this.value),n(0,s)}]}class Yt extends xe{constructor(e){super(),Ee(this,e,qt,Xt,o,{type:1,value:0,step:2})}}function Kt(e){let t,n,r;return{c(){t=S("input"),k(t,"type","color"),k(t,"id","color-picker"),k(t,"class","svelte-fbb8yg"),N(t,"background-color",e[0].color)},m(s,i){E(s,t,i),U(t,e[0].color),n||(r=[A(t,"input",e[9]),A(t,"input",e[8])],n=!0)},p(e,n){1&n&&U(t,e[0].color),1&n&&N(t,"background-color",e[0].color)},d(e){e&&x(t),n=!1,s(r)}}}function Jt(e){let t,n,r,s,i,o,a,c;return t=new Yt({props:{type:"number",value:e[2],step:.001}}),t.$on("input",e[12]),i=new Yt({props:{type:"number",value:e[3],step:.001}}),i.$on("input",e[13]),{c(){ge(t.$$.fragment),n=L(),r=S("span"),r.textContent="+",s=L(),ge(i.$$.fragment),o=L(),a=S("span"),a.textContent="i",k(r,"class","non-clickable svelte-fbb8yg"),k(a,"class","non-clickable letter-i svelte-fbb8yg")},m(e,l){ve(t,e,l),E(e,n,l),E(e,r,l),E(e,s,l),ve(i,e,l),E(e,o,l),E(e,a,l),c=!0},p(e,n){const r={};4&n&&(r.value=e[2]),t.$set(r);const s={};8&n&&(s.value=e[3]),i.$set(s)},i(e){c||(le(t.$$.fragment,e),le(i.$$.fragment,e),c=!0)},o(e){ue(t.$$.fragment,e),ue(i.$$.fragment,e),c=!1},d(e){ye(t,e),e&&x(n),e&&x(r),e&&x(s),ye(i,e),e&&x(o),e&&x(a)}}}function Zt(t){let n,r,i,o,a,c;return{c(){n=S("input"),k(n,"id","value-input"),k(n,"type","number"),k(n,"min",r=t[0].min),k(n,"max",i=t[0].max),k(n,"step",o=t[0].step),k(n,"class","svelte-fbb8yg")},m(e,r){E(e,n,r),U(n,t[0].value),a||(c=[A(n,"input",t[11]),A(n,"input",t[8])],a=!0)},p(e,t){1&t&&r!==(r=e[0].min)&&k(n,"min",r),1&t&&i!==(i=e[0].max)&&k(n,"max",i),1&t&&o!==(o=e[0].step)&&k(n,"step",o),1&t&&T(n.value)!==e[0].value&&U(n,e[0].value)},i:e,o:e,d(e){e&&x(n),a=!1,s(c)}}}function en(e){let t,n,r,i,o,a,c,l,u,h,d,m,f,p=e[0].min+"",g=e[0].max+"";return{c(){t=S("div"),n=S("span"),r=R(p),i=L(),o=S("input"),u=L(),h=S("span"),d=R(g),k(o,"id","slider"),k(o,"type","range"),k(o,"min",a=e[0].min),k(o,"max",c=e[0].max),k(o,"step",l=e[0].step),k(o,"class","svelte-fbb8yg"),k(t,"id","row2"),k(t,"class","svelte-fbb8yg")},m(s,a){E(s,t,a),v(t,n),v(n,r),v(t,i),v(t,o),U(o,e[0].value),v(t,u),v(t,h),v(h,d),m||(f=[A(o,"change",e[19]),A(o,"input",e[19]),A(o,"input",e[8])],m=!0)},p(e,t){1&t&&p!==(p=e[0].min+"")&&_(r,p),1&t&&a!==(a=e[0].min)&&k(o,"min",a),1&t&&c!==(c=e[0].max)&&k(o,"max",c),1&t&&l!==(l=e[0].step)&&k(o,"step",l),1&t&&U(o,e[0].value),1&t&&g!==(g=e[0].max+"")&&_(d,g)},d(e){e&&x(t),m=!1,s(f)}}}function tn(e){let t;function n(e,t){return"float"===e[0].type?rn:nn}let r=n(e),s=r(e);return{c(){t=S("div"),s.c(),k(t,"id","edit-ui"),k(t,"class","svelte-fbb8yg")},m(e,n){E(e,t,n),s.m(t,null)},p(e,i){r===(r=n(e))&&s?s.p(e,i):(s.d(1),s=r(e),s&&(s.c(),s.m(t,null)))},d(e){e&&x(t),s.d()}}}function nn(t){let n,r,s;return{c(){n=S("button"),n.textContent="Reset",k(n,"id","reset-point-btn"),k(n,"class","svelte-fbb8yg")},m(e,i){E(e,n,i),r||(s=A(n,"click",t[5]),r=!0)},p:e,d(e){e&&x(n),r=!1,s()}}}function rn(e){let t,n,r,i,o,a,c,l,u,h;return{c(){t=S("span"),t.textContent="Min: ",n=S("input"),r=L(),i=S("span"),i.textContent="Max: ",o=S("input"),a=L(),c=S("span"),c.textContent="Step: ",l=S("input"),k(n,"type","number"),k(n,"class","svelte-fbb8yg"),k(o,"type","number"),k(o,"class","svelte-fbb8yg"),k(l,"type","number"),k(l,"class","svelte-fbb8yg")},m(s,d){E(s,t,d),E(s,n,d),U(n,e[0].min),E(s,r,d),E(s,i,d),E(s,o,d),U(o,e[0].max),E(s,a,d),E(s,c,d),E(s,l,d),U(l,e[0].step),u||(h=[A(n,"input",e[16]),A(o,"input",e[17]),A(l,"input",e[18])],u=!0)},p(e,t){1&t&&T(n.value)!==e[0].min&&U(n,e[0].min),1&t&&T(o.value)!==e[0].max&&U(o,e[0].max),1&t&&T(l.value)!==e[0].step&&U(l,e[0].step)},d(e){e&&x(t),e&&x(n),e&&x(r),e&&x(i),e&&x(o),e&&x(a),e&&x(c),e&&x(l),u=!1,s(h)}}}function sn(e){let t,n,r,i,o,a,c,l,u,h,d,m,f,p,g,y,b,$,R,w="vec2"===e[0].type&&Kt(e);function T(t){e[10](t)}let _={type:"text"};void 0!==e[0].name&&(_.value=e[0].name),i=new Yt({props:_}),V.push((()=>pe(i,"value",T))),i.$on("input",e[6]);const U=[Zt,Jt],N=[];function O(e,t){return"float"===e[0].type?0:"vec2"===e[0].type?1:-1}function F(e,t){return e[1]?tn:"float"===e[0].type?en:void 0}~(u=O(e))&&(h=N[u]=U[u](e));let C=F(e),B=C&&C(e);return{c(){t=S("div"),n=S("div"),w&&w.c(),r=L(),ge(i.$$.fragment),a=L(),c=S("span"),c.textContent="=",l=L(),h&&h.c(),d=L(),m=S("button"),f=S("i"),p=L(),g=S("button"),g.innerHTML='<i class="bi bi-x-circle svelte-fbb8yg"></i>',y=L(),B&&B.c(),k(c,"class","non-clickable svelte-fbb8yg"),k(f,"class","bi bi-gear svelte-fbb8yg"),I(f,"active",e[1]),k(m,"id","settings-btn"),k(m,"class","svelte-fbb8yg"),k(g,"class","svelte-fbb8yg"),k(n,"id","row1"),k(n,"class","svelte-fbb8yg"),k(t,"id","container"),k(t,"class","svelte-fbb8yg")},m(s,o){E(s,t,o),v(t,n),w&&w.m(n,null),v(n,r),ve(i,n,null),v(n,a),v(n,c),v(n,l),~u&&N[u].m(n,null),v(n,d),v(n,m),v(m,f),v(n,p),v(n,g),v(t,y),B&&B.m(t,null),b=!0,$||(R=[A(m,"click",e[14]),A(g,"click",e[15]),A(t,"keydown",e[20])],$=!0)},p(e,[s]){"vec2"===e[0].type?w?w.p(e,s):(w=Kt(e),w.c(),w.m(n,r)):w&&(w.d(1),w=null);const a={};!o&&1&s&&(o=!0,a.value=e[0].name,K((()=>o=!1))),i.$set(a);let c=u;u=O(e),u===c?~u&&N[u].p(e,s):(h&&(ae(),ue(N[c],1,1,(()=>{N[c]=null})),ce()),~u?(h=N[u],h?h.p(e,s):(h=N[u]=U[u](e),h.c()),le(h,1),h.m(n,d)):h=null),(!b||2&s)&&I(f,"active",e[1]),C===(C=F(e))&&B?B.p(e,s):(B&&B.d(1),B=C&&C(e),B&&(B.c(),B.m(t,null)))},i(e){b||(le(i.$$.fragment,e),le(h),b=!0)},o(e){ue(i.$$.fragment,e),ue(h),b=!1},d(e){e&&x(t),w&&w.d(),ye(i),~u&&N[u].d(),B&&B.d(),$=!1,s(R)}}}function on(e,t,n){let r,s,{data:i}=t,o=j(),a=!1,c=i.name;function l(e,t){"vec2"===i.type&&("x"===e&&n(0,i.x=t.target.value,i),"y"===e&&n(0,i.y=t.target.value,i),u())}function u(){console.log("value change",i),o("valueChange",i),"float"===i.type&&(n(0,i.min=Math.min(i.min,i.value),i),n(0,i.max=Math.max(i.max,i.value),i))}return e.$$set=e=>{"data"in e&&n(0,i=e.data)},e.$$.update=()=>{1&e.$$.dirty&&"vec2"===i.type&&(n(2,r=Me(i.x,3)),n(3,s=Me(i.y,3)))},[i,a,r,s,o,function(){"vec2"===i.type&&(n(0,i.x=0,i),n(0,i.y=0,i)),u(),n(1,a=!1)},function(){o("nameChange",{prevName:c,data:i}),c=i.name},l,u,function(){i.color=this.value,n(0,i)},function(t){e.$$.not_equal(i.name,t)&&(i.name=t,n(0,i))},function(){i.value=T(this.value),n(0,i)},e=>l("x",e),e=>l("y",e),()=>n(1,a=!a),()=>o("delete",i),function(){i.min=T(this.value),n(0,i)},function(){i.max=T(this.value),n(0,i)},function(){i.step=T(this.value),n(0,i)},function(){i.value=T(this.value),n(0,i)},e=>{"Enter"===e.key&&n(1,a=!1)}]}class an extends xe{constructor(e){super(),Ee(this,e,on,sn,o,{data:0})}}function cn(t){let n,r,i,o,a,c,l,u,h,d,m,f,p,g,y,b,$,R,w,T,_,U,N,I,O;return{c(){n=S("div"),r=S("div"),i=S("span"),i.textContent="Grid on:",o=L(),a=S("input"),c=L(),l=S("div"),u=S("span"),u.textContent="Grid spacing:",h=L(),d=S("input"),m=L(),f=S("div"),p=S("span"),p.textContent="Mod contours:",g=L(),y=S("input"),b=L(),$=S("div"),R=S("span"),R.textContent="Phase contours:",w=L(),T=S("input"),_=L(),U=S("div"),N=S("button"),N.textContent="Reset camera (h)",k(i,"class","label svelte-1jasimh"),k(a,"type","checkbox"),a.checked=t[2]("showGrid"),k(a,"class","svelte-1jasimh"),k(r,"class","setting svelte-1jasimh"),k(u,"class","label svelte-1jasimh"),k(d,"type","range"),k(d,"min","0.05"),k(d,"max","2.0"),k(d,"step","0.001"),d.value=t[2]("gridSpacing"),k(d,"class","svelte-1jasimh"),k(l,"class","setting svelte-1jasimh"),k(p,"class","label svelte-1jasimh"),k(y,"type","checkbox"),y.checked=t[2]("showModContours"),k(y,"class","svelte-1jasimh"),k(f,"class","setting svelte-1jasimh"),k(R,"class","label svelte-1jasimh"),k(T,"type","checkbox"),T.checked=t[2]("showPhaseContours"),k(T,"class","svelte-1jasimh"),k($,"class","setting svelte-1jasimh"),k(N,"class","svelte-1jasimh"),k(U,"id","buttons"),k(U,"class","svelte-1jasimh"),k(n,"id","container"),k(n,"class","svelte-1jasimh")},m(e,s){E(e,n,s),v(n,r),v(r,i),v(r,o),v(r,a),v(n,c),v(n,l),v(l,u),v(l,h),v(l,d),v(n,m),v(n,f),v(f,p),v(f,g),v(f,y),v(n,b),v(n,$),v($,R),v($,w),v($,T),v(n,_),v(n,U),v(U,N),I||(O=[A(a,"change",t[3]),A(d,"input",t[4]),A(y,"change",t[5]),A(T,"change",t[6]),A(N,"click",t[7])],I=!0)},p:e,d(e){e&&x(n),I=!1,s(O)}}}function ln(t){let n,r=t[1],s=cn(t);return{c(){s.c(),n=w()},m(e,t){s.m(e,t),E(e,n,t)},p(e,[t]){2&t&&o(r,r=e[1])?(s.d(1),s=cn(e),s.c(),s.m(n.parentNode,n)):s.p(e,t)},i:e,o:e,d(e){e&&x(n),s.d(e)}}}function un(e,t,n){let{canvas:r}=t,s=r.settings;return e.$$set=e=>{"canvas"in e&&n(0,r=e.canvas)},[r,s,function(e){return r.settings.has(e)||console.error(`Setting ${e} not found`),r.settings.get(e).value},e=>r.updateSetting("showGrid",e.target.checked),e=>r.updateSetting("gridSpacing",e.target.value),e=>r.updateSetting("showModContours",e.target.checked),e=>r.updateSetting("showPhaseContours",e.target.checked),()=>r.camera.reset()]}class hn extends xe{constructor(e){super(),Ee(this,e,un,ln,o,{canvas:0})}}function dn(e,t,n){const r=e.slice();return r[21]=t[n],r}function mn(e){let t,n,r,s;return n=new hn({props:{canvas:e[2]}}),{c(){t=S("div"),ge(n.$$.fragment),k(t,"id","controls-tab"),k(t,"class","svelte-1tnafci")},m(e,r){E(e,t,r),ve(n,t,null),s=!0},p(t,r){e=t;const s={};4&r&&(s.canvas=e[2]),n.$set(s)},i(e){s||(le(n.$$.fragment,e),Y((()=>{r||(r=de(t,Ot,{x:-100,duration:vn},!0)),r.run(1)})),s=!0)},o(e){ue(n.$$.fragment,e),r||(r=de(t,Ot,{x:-100,duration:vn},!1)),r.run(0),s=!1},d(e){e&&x(t),ye(n),e&&r&&r.end()}}}function fn(n){let r,o,a,c,l,u,h,m,f,p,y,b,$,R,w,T,_=[],U=new Map;function N(e){n[13](e)}let I={canvas:n[2]};void 0!==n[1]&&(I.code=n[1]),a=new Vt({props:I}),V.push((()=>pe(a,"code",N)));let O=n[4];const F=e=>e[21].id;for(let e=0;e<O.length;e+=1){let t=dn(n,O,e),r=F(t);U.set(r,_[e]=pn(r,t))}return{c(){r=S("div"),o=S("div"),ge(a.$$.fragment),l=L(),u=S("div");for(let e=0;e<_.length;e+=1)_[e].c();h=L(),m=S("div"),f=S("button"),f.innerHTML='<i class="bi bi-plus svelte-1tnafci"></i>Add slider',p=L(),y=S("button"),y.innerHTML='<i class="bi bi-plus svelte-1tnafci"></i>Add point',k(u,"id","variables-area"),k(f,"class","add-slider-btn svelte-1tnafci"),k(y,"class","add-slider-btn svelte-1tnafci"),k(m,"id","buttons"),k(m,"class","svelte-1tnafci"),k(o,"id","main-tab-inner"),k(o,"class","svelte-1tnafci"),k(r,"id","main-tab"),k(r,"class","svelte-1tnafci")},m(e,t){E(e,r,t),v(r,o),ve(a,o,null),v(o,l),v(o,u);for(let e=0;e<_.length;e+=1)_[e].m(u,null);v(o,h),v(o,m),v(m,f),v(m,p),v(m,y),R=!0,w||(T=[A(f,"click",n[17]),A(y,"click",n[18]),A(r,"outrostart",De)],w=!0)},p(e,t){n=e;const r={};4&t&&(r.canvas=n[2]),!c&&2&t&&(c=!0,r.code=n[1],K((()=>c=!1))),a.$set(r),1808&t&&(O=n[4],ae(),_=fe(_,t,F,1,n,O,U,u,me,pn,null,dn),ce())},i(n){if(!R){le(a.$$.fragment,n);for(let e=0;e<O.length;e+=1)le(_[e]);Y((()=>{$&&$.end(1),b=function(n,r,s){const o={direction:"in"};let a,c,l=r(n,s,o),u=!1,h=0;function m(){a&&M(n,a)}function f(){const{delay:r=0,duration:s=300,easing:i=t,tick:o=e,css:f}=l||he;f&&(a=D(n,0,1,s,r,i,f,h++)),o(0,1);const p=d()+r,v=p+s;c&&c.abort(),u=!0,Y((()=>se(n,!0,"start"))),c=g((e=>{if(u){if(e>=v)return o(1,0),se(n,!0,"end"),m(),u=!1;if(e>=p){const t=i((e-p)/s);o(t,1-t)}}return u}))}let p=!1;return{start(){p||(p=!0,M(n),i(l)?(l=l(o),re().then(f)):f())},invalidate(){p=!1},end(){u&&(m(),u=!1)}}}(r,Ot,{x:-10,duration:vn}),b.start()})),R=!0}},o(n){ue(a.$$.fragment,n);for(let e=0;e<_.length;e+=1)ue(_[e]);b&&b.invalidate(),$=function(n,r,o){const a={direction:"out"};let c,l=r(n,o,a),u=!0;const h=oe;function m(){const{delay:r=0,duration:i=300,easing:o=t,tick:a=e,css:m}=l||he;m&&(c=D(n,1,0,i,r,o,m));const f=d()+r,p=f+i;Y((()=>se(n,!1,"start"))),g((e=>{if(u){if(e>=p)return a(0,1),se(n,!1,"end"),--h.r||s(h.c),!1;if(e>=f){const t=o((e-f)/i);a(1-t,t)}}return u}))}return h.r+=1,i(l)?re().then((()=>{l=l(a),m()})):m(),{end(e){e&&l.tick&&l.tick(1,0),u&&(c&&M(n,c),u=!1)}}}(r,Ot,{x:10,duration:vn}),R=!1},d(e){e&&x(r),ye(a);for(let e=0;e<_.length;e+=1)_[e].d();e&&$&&$.end(),w=!1,s(T)}}}function pn(e,t){let n,r,s;return r=new an({props:{data:t[21]}}),r.$on("delete",t[14]),r.$on("nameChange",t[15]),r.$on("valueChange",t[16]),{key:e,first:null,c(){n=w(),ge(r.$$.fragment),this.first=n},m(e,t){E(e,n,t),ve(r,e,t),s=!0},p(e,n){t=e;const s={};16&n&&(s.data=t[21]),r.$set(s)},i(e){s||(le(r.$$.fragment,e),s=!0)},o(e){ue(r.$$.fragment,e),s=!1},d(e){e&&x(n),ye(r,e)}}}function gn(e){let t,n,r,s,i,o,a,c,l,u,h,d,m,f,p;function g(t){e[11](t)}let y={tabs:e[5]};void 0!==e[3]&&(y.activeTab=e[3]),r=new wt({props:y}),V.push((()=>pe(r,"activeTab",g)));const b=[fn,mn],$=[];function R(e,t){return 1==e[3].id?0:2==e[3].id?1:-1}return~(h=R(e))&&(d=$[h]=b[h](e)),{c(){t=S("div"),n=S("div"),ge(r.$$.fragment),i=L(),o=S("button"),a=S("i"),l=L(),u=S("div"),d&&d.c(),k(a,"class",c="bi bi-chevron-double-"+(e[0]?"right":"left")+" svelte-1tnafci"),k(o,"id","btn-collapse"),k(o,"class","svelte-1tnafci"),k(n,"id","tab-area"),k(u,"id","below-tab-area"),k(u,"class","svelte-1tnafci"),k(t,"id","sidebar"),k(t,"class","svelte-1tnafci")},m(s,c){E(s,t,c),v(t,n),ve(r,n,null),v(n,i),v(n,o),v(o,a),v(t,l),v(t,u),~h&&$[h].m(u,null),m=!0,f||(p=A(o,"click",e[12]),f=!0)},p(e,[t]){const n={};!s&&8&t&&(s=!0,n.activeTab=e[3],K((()=>s=!1))),r.$set(n),(!m||1&t&&c!==(c="bi bi-chevron-double-"+(e[0]?"right":"left")+" svelte-1tnafci"))&&k(a,"class",c);let i=h;h=R(e),h===i?~h&&$[h].p(e,t):(d&&(ae(),ue($[i],1,1,(()=>{$[i]=null})),ce()),~h?(d=$[h],d?d.p(e,t):(d=$[h]=b[h](e),d.c()),le(d,1),d.m(u,null)):d=null)},i(e){m||(le(r.$$.fragment,e),le(d),m=!0)},o(e){ue(r.$$.fragment,e),ue(d),m=!1},d(e){e&&x(t),ye(r),~h&&$[h].d(),f=!1,p()}}}let vn=150;function yn(e,t,n){let r;l(e,We,(e=>n(4,r=e)));let{canvas:s}=t,{collapsed:i=!1}=t,{editorText:o=""}=t,a=j(),c=[{name:"Main",id:1},{name:"Settings",id:2}],h=c[0];function d(e){return r.some((t=>t.id!==e.id&&t.name===e.name))}function m(e="",t=0,n=-10,i=10,o=.001){u(We,r=[...r,{id:Be(),type:"float",name:e,value:t,min:n,max:i,step:o}],r),e.trim()&&s.addUniform(e,t,"float")}function f(e="",t=0,n=0,i=ze()){u(We,r=[...r,{id:Be(),type:"vec2",name:e,x:t,y:n,color:i}],r),e.trim()&&s.addUniform(e,[t,n],"vec2")}function p(e){u(We,r=r.filter((t=>t.id!==e.id)),r),d(e)||(s.deleteUniform(e.name),s.compileUserCodeToGlsl(o,!0))}function g(e){We.set(r),console.log("value change",r),a("variableChange",e),e.name.trim()&&(s.setUniformValue(e.name,"float"===e.type?e.value:[e.x,e.y]),s.render())}function v(e){We.set(r);let[t,n]=[e.prevName,e.data];t.trim()&&!r.some((e=>e.name===t&&e.id!==n.id))&&s.deleteUniform(t),d(n)?console.error("Duplicate name ",n.name):n.name.trim()&&("float"===n.type?s.addUniform(n.name,n.value,"float"):"vec2"===n.type&&s.addUniform(n.name,[n.x,n.y],"vec2")),s.compileUserCodeToGlsl(o,!0)}return e.$$set=e=>{"canvas"in e&&n(2,s=e.canvas),"collapsed"in e&&n(0,i=e.collapsed),"editorText"in e&&n(1,o=e.editorText)},[i,o,s,h,r,c,m,f,p,g,v,function(e){h=e,n(3,h)},()=>n(0,i=!i),function(e){o=e,n(1,o)},e=>p(e.detail),e=>v(e.detail),e=>g(e.detail),e=>m(),e=>f()]}class bn extends xe{constructor(e){super(),Ee(this,e,yn,gn,o,{canvas:2,collapsed:0,editorText:1})}}var En="undefined"!=typeof window?window:null,xn=null===En,$n=xn?void 0:En.document,Sn="addEventListener",Rn="removeEventListener",Ln="getBoundingClientRect",wn="_a",An="_b",kn="_c",Tn="horizontal",_n=function(){return!1},Un=xn?"calc":["","-webkit-","-moz-","-o-"].filter((function(e){var t=$n.createElement("div");return t.style.cssText="width:"+e+"calc(9px)",!!t.style.length})).shift()+"calc",Nn=function(e){return"string"==typeof e||e instanceof String},In=function(e){if(Nn(e)){var t=$n.querySelector(e);if(!t)throw new Error("Selector "+e+" did not match a DOM element");return t}return e},On=function(e,t,n){var r=e[t];return void 0!==r?r:n},Fn=function(e,t,n,r){if(t){if("end"===r)return 0;if("center"===r)return e/2}else if(n){if("start"===r)return 0;if("center"===r)return e/2}return e},Cn=function(e,t){var n=$n.createElement("div");return n.className="gutter gutter-"+t,n},Bn=function(e,t,n){var r={};return Nn(t)?r[e]=t:r[e]=Un+"("+t+"% - "+n+"px)",r},Dn=function(e,t){var n;return(n={})[e]=t+"px",n},Mn=function(e,t){if(void 0===t&&(t={}),xn)return{};var n,r,s,i,o,a,c=e;Array.from&&(c=Array.from(c));var l=In(c[0]).parentNode,u=getComputedStyle?getComputedStyle(l):null,h=u?u.flexDirection:null,d=On(t,"sizes")||c.map((function(){return 100/c.length})),m=On(t,"minSize",100),f=Array.isArray(m)?m:c.map((function(){return m})),p=On(t,"maxSize",1/0),g=Array.isArray(p)?p:c.map((function(){return p})),v=On(t,"expandToMin",!1),y=On(t,"gutterSize",10),b=On(t,"gutterAlign","center"),E=On(t,"snapOffset",30),x=Array.isArray(E)?E:c.map((function(){return E})),$=On(t,"dragInterval",1),S=On(t,"direction",Tn),R=On(t,"cursor",S===Tn?"col-resize":"row-resize"),L=On(t,"gutter",Cn),w=On(t,"elementStyle",Bn),A=On(t,"gutterStyle",Dn);function k(e,t,r,s){var i=w(n,t,r,s);Object.keys(i).forEach((function(t){e.style[t]=i[t]}))}function T(){return a.map((function(e){return e.size}))}function _(e){return"touches"in e?e.touches[0][r]:e[r]}function U(e){var t=a[this.a],n=a[this.b],r=t.size+n.size;t.size=e/this.size*r,n.size=r-e/this.size*r,k(t.element,t.size,this[An],t.i),k(n.element,n.size,this[kn],n.i)}function N(e){var n,r=a[this.a],s=a[this.b];this.dragging&&(n=_(e)-this.start+(this[An]-this.dragOffset),$>1&&(n=Math.round(n/$)*$),n<=r.minSize+r.snapOffset+this[An]?n=r.minSize+this[An]:n>=this.size-(s.minSize+s.snapOffset+this[kn])&&(n=this.size-(s.minSize+this[kn])),n>=r.maxSize-r.snapOffset+this[An]?n=r.maxSize+this[An]:n<=this.size-(s.maxSize-s.snapOffset+this[kn])&&(n=this.size-(s.maxSize+this[kn])),U.call(this,n),On(t,"onDrag",_n)(T()))}function I(){var e=a[this.a].element,t=a[this.b].element,r=e[Ln](),o=t[Ln]();this.size=r[n]+o[n]+this[An]+this[kn],this.start=r[s],this.end=r[i]}function O(e){var t=function(e){if(!getComputedStyle)return null;var t=getComputedStyle(e);if(!t)return null;var n=e[o];return 0===n?null:n-=S===Tn?parseFloat(t.paddingLeft)+parseFloat(t.paddingRight):parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)}(l);if(null===t)return e;if(f.reduce((function(e,t){return e+t}),0)>t)return e;var n=0,r=[],s=e.map((function(s,i){var o=t*s/100,a=Fn(y,0===i,i===e.length-1,b),c=f[i]+a;return o<c?(n+=c-o,r.push(0),c):(r.push(o-c),o)}));return 0===n?e:s.map((function(e,s){var i=e;if(n>0&&r[s]-n>0){var o=Math.min(n,r[s]-n);n-=o,i=e-o}return i/t*100}))}function F(){var e=this,n=a[e.a].element,r=a[e.b].element;e.dragging&&On(t,"onDragEnd",_n)(T()),e.dragging=!1,En[Rn]("mouseup",e.stop),En[Rn]("touchend",e.stop),En[Rn]("touchcancel",e.stop),En[Rn]("mousemove",e.move),En[Rn]("touchmove",e.move),e.stop=null,e.move=null,n[Rn]("selectstart",_n),n[Rn]("dragstart",_n),r[Rn]("selectstart",_n),r[Rn]("dragstart",_n),n.style.userSelect="",n.style.webkitUserSelect="",n.style.MozUserSelect="",n.style.pointerEvents="",r.style.userSelect="",r.style.webkitUserSelect="",r.style.MozUserSelect="",r.style.pointerEvents="",e.gutter.style.cursor="",e.parent.style.cursor="",$n.body.style.cursor=""}function C(e){if(!("button"in e)||0===e.button){var n=this,r=a[n.a].element,s=a[n.b].element;n.dragging||On(t,"onDragStart",_n)(T()),e.preventDefault(),n.dragging=!0,n.move=N.bind(n),n.stop=F.bind(n),En[Sn]("mouseup",n.stop),En[Sn]("touchend",n.stop),En[Sn]("touchcancel",n.stop),En[Sn]("mousemove",n.move),En[Sn]("touchmove",n.move),r[Sn]("selectstart",_n),r[Sn]("dragstart",_n),s[Sn]("selectstart",_n),s[Sn]("dragstart",_n),r.style.userSelect="none",r.style.webkitUserSelect="none",r.style.MozUserSelect="none",r.style.pointerEvents="none",s.style.userSelect="none",s.style.webkitUserSelect="none",s.style.MozUserSelect="none",s.style.pointerEvents="none",n.gutter.style.cursor=R,n.parent.style.cursor=R,$n.body.style.cursor=R,I.call(n),n.dragOffset=_(e)-n.end}}S===Tn?(n="width",r="clientX",s="left",i="right",o="clientWidth"):"vertical"===S&&(n="height",r="clientY",s="top",i="bottom",o="clientHeight"),d=O(d);var B=[];function D(e){var t=e.i===B.length,n=t?B[e.i-1]:B[e.i];I.call(n);var r=t?n.size-e.minSize-n[kn]:e.minSize+n[An];U.call(n,r)}return a=c.map((function(e,t){var r,s={element:In(e),size:d[t],minSize:f[t],maxSize:g[t],snapOffset:x[t],i:t};if(t>0&&((r={a:t-1,b:t,dragging:!1,direction:S,parent:l})[An]=Fn(y,t-1==0,!1,b),r[kn]=Fn(y,!1,t===c.length-1,b),"row-reverse"===h||"column-reverse"===h)){var i=r.a;r.a=r.b,r.b=i}if(t>0){var o=L(t,S,s.element);!function(e,t,r){var s=A(n,t,r);Object.keys(s).forEach((function(t){e.style[t]=s[t]}))}(o,y,t),r[wn]=C.bind(r),o[Sn]("mousedown",r[wn]),o[Sn]("touchstart",r[wn]),l.insertBefore(o,s.element),r.gutter=o}return k(s.element,s.size,Fn(y,0===t,t===c.length-1,b),t),t>0&&B.push(r),s})),a.forEach((function(e){var t=e.element[Ln]()[n];t<e.minSize&&(v?D(e):e.minSize=t)})),{setSizes:function(e){var t=O(e);t.forEach((function(e,n){if(n>0){var r=B[n-1],s=a[r.a],i=a[r.b];s.size=t[n-1],i.size=e,k(s.element,s.size,r[An],s.i),k(i.element,i.size,r[kn],i.i)}}))},getSizes:T,collapse:function(e){D(a[e])},destroy:function(e,t){B.forEach((function(r){if(!0!==t?r.parent.removeChild(r.gutter):(r.gutter[Rn]("mousedown",r[wn]),r.gutter[Rn]("touchstart",r[wn])),!0!==e){var s=w(n,r.a.size,r[An]);Object.keys(s).forEach((function(e){a[r.a].element.style[e]="",a[r.b].element.style[e]=""}))}}))},parent:l,pairs:B}};function zn(t){let n,r,i,o;return{c(){n=S("div"),r=S("div"),k(r,"id","point"),N(r,"width",Pn+"px"),N(r,"height",Pn+"px"),N(r,"background-color",t[0].color),k(r,"class","svelte-1sav52n"),I(r,"dragging",t[1]),k(n,"id","container"),N(n,"left",t[2].x+"px"),N(n,"top",t[2].y+"px"),k(n,"class","svelte-1sav52n")},m(e,s){var a;E(e,n,s),v(n,r),i||(o=[A(r,"mousedown",t[5]),A(r,"mouseup",t[6]),A(r,"mousemove",(a=t[3],function(e){return e.stopPropagation(),a.call(this,e)}))],i=!0)},p(e,[t]){1&t&&N(r,"background-color",e[0].color),2&t&&I(r,"dragging",e[1]),4&t&&N(n,"left",e[2].x+"px"),4&t&&N(n,"top",e[2].y+"px")},i:e,o:e,d(e){e&&x(n),i=!1,s(o)}}}let Pn=20;function jn(e,t,n){let r;l(e,We,(e=>n(7,r=e)));let{canvas:s}=t,{data:i}=t,o=!1,a=s.camera.worldToScreen(i.x,i.y);function c(e){if(!o)return;const t=s.c.getBoundingClientRect();let[c,l]=[e.clientX-t.left,e.clientY-t.top];n(2,a={x:c-Pn/2,y:l-Pn/2});let u=s.camera.screenToWorld(c,l);n(0,i.x=u.x,i),n(0,i.y=u.y,i),We.set(r),i.name.trim()&&(s.setUniformValue(i.name,[i.x,i.y]),s.render())}a={x:a.x-Pn/2,y:a.y-Pn/2},s.c.addEventListener("mouseup",(e=>{n(1,o=!1)})),s.c.addEventListener("mousemove",c);return e.$$set=e=>{"canvas"in e&&n(4,s=e.canvas),"data"in e&&n(0,i=e.data)},[i,o,a,c,s,()=>n(1,o=!0),()=>{n(1,o=!1)}]}class Gn extends xe{constructor(e){super(),Ee(this,e,jn,zn,o,{canvas:4,data:0})}}function Wn(e,t,n){const r=e.slice();return r[24]=t[n],r}function Vn(e){let t,n,r;function s(t){e[13](t)}let i={canvas:e[1],editorText:e[11].code};return void 0!==e[0]&&(i.collapsed=e[0]),t=new bn({props:i}),V.push((()=>pe(t,"collapsed",s))),t.$on("variableChange",e[14]),{c(){ge(t.$$.fragment)},m(e,n){ve(t,e,n),r=!0},p(e,r){const s={};2&r&&(s.canvas=e[1]),!n&&1&r&&(n=!0,s.collapsed=e[0],K((()=>n=!1))),t.$set(s)},i(e){r||(le(t.$$.fragment,e),r=!0)},o(e){ue(t.$$.fragment,e),r=!1},d(e){ye(t,e)}}}function Qn(t){let n,r,s;return{c(){n=S("button"),n.innerHTML='<i class="bi bi-chevron-double-right svelte-15mw8jo"></i>',k(n,"id","expand-btn"),k(n,"class","svelte-15mw8jo")},m(e,i){E(e,n,i),r||(s=A(n,"click",t[16]),r=!0)},p:e,d(e){e&&x(n),r=!1,s()}}}function Hn(t){let n,r,s=[t[4],t[5]],i=Yn(t);return{c(){i.c(),n=w()},m(e,t){i.m(e,t),E(e,n,t),r=!0},p(t,r){48&r&&o(s,s=[t[4],t[5]])?(ae(),ue(i,1,1,e),ce(),i=Yn(t),i.c(),le(i,1),i.m(n.parentNode,n)):i.p(t,r)},i(e){r||(le(i),r=!0)},o(e){ue(i),r=!1},d(e){e&&x(n),i.d(e)}}}function Xn(e){let t,n;return t=new Gn({props:{canvas:e[1],data:e[24]}}),{c(){ge(t.$$.fragment)},m(e,r){ve(t,e,r),n=!0},p(e,n){const r={};2&n&&(r.canvas=e[1]),1024&n&&(r.data=e[24]),t.$set(r)},i(e){n||(le(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function qn(e,t){let n,r,s,i="vec2"===t[24].type&&Xn(t);return{key:e,first:null,c(){n=w(),i&&i.c(),r=w(),this.first=n},m(e,t){E(e,n,t),i&&i.m(e,t),E(e,r,t),s=!0},p(e,n){"vec2"===(t=e)[24].type?i?(i.p(t,n),1024&n&&le(i,1)):(i=Xn(t),i.c(),le(i,1),i.m(r.parentNode,r)):i&&(ae(),ue(i,1,1,(()=>{i=null})),ce())},i(e){s||(le(i),s=!0)},o(e){ue(i),s=!1},d(e){e&&x(n),i&&i.d(e),e&&x(r)}}}function Yn(e){let t,n,r=[],s=new Map,i=e[10];const o=e=>e[24].id;for(let t=0;t<i.length;t+=1){let n=Wn(e,i,t),a=o(n);s.set(a,r[t]=qn(a,n))}return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=w()},m(e,s){for(let t=0;t<r.length;t+=1)r[t].m(e,s);E(e,t,s),n=!0},p(e,n){1026&n&&(i=e[10],ae(),r=fe(r,n,o,1,e,i,s,t.parentNode,me,qn,t,Wn),ce())},i(e){if(!n){for(let e=0;e<i.length;e+=1)le(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)ue(r[e]);n=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&x(t)}}}function Kn(e){let t,n;return t=new xt({props:{mouse:e[3],fval:e[1].computeFval(e[3])}}),{c(){ge(t.$$.fragment)},m(e,r){ve(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.mouse=e[3]),10&n&&(r.fval=e[1].computeFval(e[3])),t.$set(r)},i(e){n||(le(t.$$.fragment,e),n=!0)},o(e){ue(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Jn(e){let t,n,r,s,i,o,a,c,l,u=e[2]&&Vn(e),h=e[0]&&e[9]&&Qn(e),d=e[2]&&e[9]&&Hn(e),m=e[2]&&e[9]&&Kn(e);return{c(){t=S("main"),n=S("div"),u&&u.c(),r=L(),s=S("div"),h&&h.c(),i=L(),o=S("canvas"),a=L(),d&&d.c(),c=L(),m&&m.c(),k(n,"id","sidebar-div"),k(n,"class","svelte-15mw8jo"),N(n,"display",e[0]?"none":"block"),k(o,"class","svelte-15mw8jo"),k(s,"id","canvas-div"),k(s,"class","svelte-15mw8jo"),k(t,"class","svelte-15mw8jo")},m(f,p){E(f,t,p),v(t,n),u&&u.m(n,null),e[15](n),v(t,r),v(t,s),h&&h.m(s,null),v(s,i),v(s,o),e[17](o),v(s,a),d&&d.m(s,null),e[18](s),v(t,c),m&&m.m(t,null),l=!0},p(e,[r]){e[2]?u?(u.p(e,r),4&r&&le(u,1)):(u=Vn(e),u.c(),le(u,1),u.m(n,null)):u&&(ae(),ue(u,1,1,(()=>{u=null})),ce()),1&r&&N(n,"display",e[0]?"none":"block"),e[0]&&e[9]?h?h.p(e,r):(h=Qn(e),h.c(),h.m(s,i)):h&&(h.d(1),h=null),e[2]&&e[9]?d?(d.p(e,r),516&r&&le(d,1)):(d=Hn(e),d.c(),le(d,1),d.m(s,null)):d&&(ae(),ue(d,1,1,(()=>{d=null})),ce()),e[2]&&e[9]?m?(m.p(e,r),516&r&&le(m,1)):(m=Kn(e),m.c(),le(m,1),m.m(t,null)):m&&(ae(),ue(m,1,1,(()=>{m=null})),ce())},i(e){l||(le(u),le(d),le(m),l=!0)},o(e){ue(u),ue(d),ue(m),l=!1},d(n){n&&x(t),u&&u.d(),e[15](null),h&&h.d(),e[17](null),d&&d.d(),e[18](null),m&&m.d()}}}function Zn(e,t,n){let r,s;l(e,Ge,(e=>n(22,r=e))),l(e,We,(e=>n(10,s=e)));var i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};let o,a,c,u,h,d,m=!1,f={x:0,y:0},p=!1,g=!1,v=!1,y=!1,b=[40,60],E=!0,x=_t[Ut];var $;$=()=>i(void 0,void 0,void 0,(function*(){console.log("App.svelte ran"),n(12,d=Mn(["#sidebar-div","#canvas-div"],{sizes:b,minSize:[380,250],gutterSize:5,gutterAlign:"start",onDragEnd:()=>{b=d.getSizes()}})),h=document.querySelector(".gutter"),n(1,o=new gt(u,x)),r.length>0?console.error("error in default workspace code: ",r[0].toString()):yield o.init((e=>console.error(e))),n(2,m=!0),u.addEventListener("mousedown",(e=>v=!0)),u.addEventListener("mouseup",(e=>v=!1)),u.addEventListener("mouseleave",(e=>v=!1)),u.addEventListener("mousemove",(e=>{v&&o.camera.move(e.movementX,e.movementY),n(3,f=o.camera.screenToWorld(e.offsetX,e.offsetY)),n(1,o.mousePos=f,o)})),c.addEventListener("wheel",(e=>{e.preventDefault();const t=u.getBoundingClientRect(),[n,r]=[e.clientX-t.left,e.clientY-t.top];o.camera.scaleAt(n,r,Math.pow(1.001,e.deltaY))})),u.addEventListener("camera",(e=>{n(4,p=!p),o.render()})),document.addEventListener("keydown",(e=>{if(document.activeElement===document.body)switch(e.key){case"h":o.camera.reset();break;case"u":n(9,E=!E),n(0,y=!E)}})),new ResizeObserver((()=>{Ae(u),n(1,o.camera.scale.x=o.camera.scale.y*o.camera.aspect(),o),n(4,p=!p),o.render()})).observe(u)})),P().$$.on_mount.push($);return e.$$.update=()=>{4097&e.$$.dirty&&d&&(h.style.display=y?"none":"block")},[y,o,m,f,p,g,a,c,u,E,s,x,d,function(e){y=e,n(0,y)},e=>{"vec2"===e.detail.type&&n(5,g=!g)},function(e){V[e?"unshift":"push"]((()=>{a=e,n(6,a)}))},()=>n(0,y=!1),function(e){V[e?"unshift":"push"]((()=>{u=e,n(8,u)}))},function(e){V[e?"unshift":"push"]((()=>{c=e,n(7,c)}))}]}return new class extends xe{constructor(e){super(),Ee(this,e,Zn,Jn,o,{})}}({target:document.body,props:{}})}();
